<!DOCTYPE html>
<html lang="en" class="dark"> <!-- Force dark mode initially as per instruction -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binance Web3 Wallet</title>

    <!-- Tailwind CSS CDN for utility-first styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind CSS configuration for dark mode and Binance-inspired custom colors
        tailwind.config = {
            darkMode: 'class', // Enables dark mode based on the 'dark' class on the html element
            theme: {
                extend: {
                    colors: {
                        // Custom Binance-like theme colors, precisely mapped from Binance's dark mode
                        // These are the requested "dark black mode Binance colour"
                        'binance-bg-primary': '#1A1D20', // Main background (very dark grey, near black)
                        'binance-bg-secondary': '#1E2329', // Card/section background (slightly lighter dark grey)
                        'binance-accent-yellow': '#FCD535', // Binance's iconic bright yellow
                        'binance-text-light': '#F0F4F8', // Light text for dark backgrounds
                        'binance-text-muted': '#A8B0BC', // Muted text for secondary info
                        'binance-surface-elevated': '#2E353C', // Deeper dark for layered elements/hover states
                        'binance-border': '#3D4955', // Border color in dark mode

                        // Specific action colors matching Binance
                        'binance-green': '#16C784', // Common green for gains/buy
                        'binance-red': '#EA3943',   // Common red for losses/sell
                        'binance-blue': '#1874D0',  // General action/info blue
                    },
                    fontFamily: {
                        // Inter font for a clean, modern look, as requested by default
                        sans: ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        // Custom shadow to match Binance's subtle UI elevations
                        'binance-sm': '0 1px 2px 0 rgba(0, 0, 0, 0.05)',
                        'binance-md': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                        'binance-lg': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                    }
                }
            }
        }
    </script>
    <!-- Link to Inter font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- React and ReactDOM CDNs -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel Standalone for in-browser JSX compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- WalletConnect Web3-Provider & Web3.js for blockchain interactions -->
    <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.0/dist/web3.min.js"></script>
    <!-- Lightweight Charts for interactive trading charts -->
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.umd.js"></script>

    <!-- PWA Manifest Link -->
</head>
<body class="font-sans antialiased text-binance-text-light bg-binance-bg-primary transition-colors duration-300">

    <!-- Root div where the React app will be mounted -->
    <div id="root"></div>

    <!-- Custom Modal for displaying messages to the user (reused throughout the app) -->
    <div id="message-modal" class="hidden fixed inset-0 z-[1000] bg-black bg-opacity-40 flex items-center justify-center">
        <div class="bg-binance-bg-secondary p-6 rounded-xl shadow-lg w-11/12 max-w-sm text-center relative">
            <span class="close-button absolute top-3 right-5 text-gray-500 hover:text-gray-300 text-3xl cursor-pointer" id="close-modal-button">&times;</span>
            <p id="modal-message" class="text-lg text-binance-text-light mt-4"></p>
        </div>
    </div>

    <!-- Main application script, using Babel for JSX processing -->
    <script type="text/babel">
        // Destructuring React hooks and functions for easier use
        const { useState, useEffect, useCallback, createContext, useContext, useRef } = React;

        // --- Global Message Modal Functions ---
        // These functions control the visibility and content of the centralized modal
        const messageModal = document.getElementById('message-modal');
        const modalMessage = document.getElementById('modal-message');
        const closeModalButton = document.getElementById('close-modal-button');

        const showModal = (message) => {
            modalMessage.textContent = message;
            messageModal.classList.remove('hidden');
        };

        const hideModal = () => {
            messageModal.classList.add('hidden');
        };

        // Event listeners for closing the modal
        if (closeModalButton) {
            closeModalButton.onclick = hideModal;
        }
        window.onclick = (event) => {
            if (event.target === messageModal) {
                hideModal();
            }
        };

        // --- PWA Setup ---
        // Handles the installation prompt and app installation events for PWA
        let deferredPrompt; // Stores the 'beforeinstallprompt' event

        function setupPWA() {
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault(); // Prevents the default browser prompt
                deferredPrompt = e; // Stores the event for later use
                console.log('beforeinstallprompt fired, deferredPrompt stored.');
            });

            window.addEventListener('appinstalled', () => {
                console.log('PWA was installed!');
                showModal('Binance Web3 Wallet PWA installed successfully!');
            });

            window.addEventListener('load', () => {
                // Dynamically creates and links the Web App Manifest
                const manifestContent = {
                    name: 'Binance Web3 Wallet',
                    short_name: 'BinanceWallet',
                    description: 'Your secure crypto wallet powered by Binance',
                    theme_color: '#1A1D20', // Theme color for the PWA
                    background_color: '#1A1D20', // Background color for the PWA splash screen
                    display: 'standalone', // Makes the app run in standalone mode
                    scope: '/', // Scope of the PWA
                    start_url: '/', // Starting URL when the PWA is launched
                    icons: [
                        // High-resolution icons for various devices
                        { src: 'https://upload.wikimedia.org/wikipedia/commons/4/4c/Binance_Logo.svg', sizes: '192x192', type: 'image/svg+xml' },
                        { src: 'https://upload.wikimedia.org/wikipedia/commons/4/4c/Binance_Logo.svg', sizes: '512x512', type: 'image/svg+xml', purpose: 'maskable' }
                    ],
                    orientation: 'portrait' // Preferred orientation
                };

                const manifestBlob = new Blob([JSON.stringify(manifestContent)], { type: 'application/json' });
                const manifestUrl = URL.createObjectURL(manifestBlob);
                const link = document.createElement('link');
                link.rel = 'manifest';
                link.href = manifestUrl;
                document.head.appendChild(link);
                console.log('Manifest linked successfully.');
                console.warn("Service Worker registration from 'blob:' URLs is often restricted by browsers in single-file setups. Full PWA offline caching may not work.");
            });
        }
        setupPWA(); // Initialize PWA setup

        // --- User Context for Persistent Login State ---
        // Provides user authentication and wallet connection status throughout the app
        const UserContext = createContext(null);

        // --- Shared Components ---
        // Component to toggle between light and dark mode
        const DarkModeToggle = ({ isDarkMode, toggleDarkMode }) => (
            <button
                onClick={toggleDarkMode}
                className="p-2 rounded-full bg-binance-bg-secondary text-binance-text-light hover:bg-binance-surface-elevated transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                aria-label="Toggle dark mode"
            >
                {/* SVG icons for sun (light) and moon (dark) */}
                {isDarkMode ? (
                    <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 10 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 00-.707-.293h-1.414a1 1 0 100 2h1.414a1 1 0 00.707-.293zm-9.192 9.192a1 1 0 00-.707.293l-.707.707a1 1 0 001.414 1.414l.707-.707a1 1 0 00-.293-1.414zM4 10a1 1 0 01-1-1V8a1 1 0 112 0v1a1 1 0 01-1 1zm-4.95-3.536a1 1 0 00.293.707L1.464 8.536a1 1 0 101.414-1.414L2.05 6.464a1 1 0 00-.707-.293zM16 10a1 1 0 01-1-1V8a1 1 0 112 0v1a1 1 0 01-1 1zm4.95-3.536a1 1 0 00-.293.707l-.707.707a1 1 0 00-1.414-1.414l.707-.707a1 1 0 00.707-.293z"></path></svg>
                ) : (
                    <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.04a.75.75 0 010 1.06l-.707.707a.75.75 0 01-1.06 0L14 13.04a6 6 0 11-8.485-8.485.75.75 0 011.06 1.06A4.5 4.5 0 1015.939 12a.75.75 0 011.354.54z"></path></svg>
                )}
            </button>
        );

        // Header component for navigation and branding
        const Header = ({ toggleDarkMode, isDarkMode, navigate, goBack, showBackButton }) => {
            const { userStatus, setUserStatus } = useContext(UserContext);

            const handleDisconnectWallet = () => {
                showModal('Disconnecting wallet...');
                setTimeout(() => {
                    setUserStatus({ ...userStatus, connectedWalletInfo: null }); // Keep login status, but clear wallet
                    showModal('Wallet disconnected!');
                    hideModal();
                }, 1500);
            };

            return (
                <header className="bg-binance-bg-secondary shadow-sm dark:shadow-md fixed top-0 left-0 right-0 z-50 transition-colors duration-300">
                    <nav className="container mx-auto px-4 py-3 flex justify-between items-center">
                        {/* Back Button, visible when not on initial landing or home page and history exists */}
                        {showBackButton && (
                            <button
                                onClick={goBack}
                                className="mr-3 p-2 rounded-full bg-binance-surface-elevated text-binance-text-light hover:bg-gray-700 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                aria-label="Go back"
                            >
                                <svg className="w-5 h-5 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 10">
                                    <path stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 5H1m0 0 4 4m-4-4 4-4"/>
                                </svg>
                            </button>
                        )}

                        {/* Binance Logo and App Title */}
                        <div className="flex items-center space-x-2 cursor-pointer" onClick={() => navigate('homePage')}>
                            <img src="https://upload.wikimedia.org/wikipedia/commons/4/4c/Binance_Logo.svg" alt="Binance Logo" className="w-10 h-10" />
                            <span className="text-xl font-bold text-binance-text-light">Binance Web3 Wallet</span>
                        </div>

                        {/* Main Navigation Links (hidden on small screens) */}
                        <div className="hidden md:flex items-center space-x-6">
                            <a href="#" onClick={() => navigate('homePage')} className="text-binance-text-light hover:text-binance-accent-yellow font-medium transition-colors duration-200">Home</a>
                            <a href="#" onClick={() => navigate('homePage')} className="text-binance-text-light hover:text-binance-accent-yellow font-medium transition-colors duration-200">Markets</a>
                            <a href="#" onClick={() => navigate('homePage')} className="text-binance-text-light hover:text-binance-accent-yellow font-medium transition-colors duration-200">Trade</a>
                            <a href="#" onClick={() => navigate('walletDashboard')} className="text-binance-text-light hover:text-binance-accent-yellow font-medium transition-colors duration-200">Earn</a>
                            {/* Always show "Wallet" link for logged-in users or if wallet is connected for quick access */}
                            {(userStatus.isLoggedIn || userStatus.connectedWalletInfo) && (
                                <a href="#" onClick={() => navigate('walletDashboard')} className="text-binance-text-light hover:text-binance-accent-yellow font-medium transition-colors duration-200">Wallet</a>
                            )}
                        </div>

                        {/* Action Buttons (Login, Connect Wallet, Settings) and Dark Mode Toggle */}
                        <div className="flex items-center space-x-3 sm:space-x-4">
                            {!userStatus.isLoggedIn && (
                                <button
                                    onClick={() => navigate('loginPage')}
                                    className="hidden sm:inline-block px-4 py-2 text-sm font-semibold text-binance-text-light rounded-lg hover:bg-binance-surface-elevated transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                >
                                    Log In
                                </button>
                            )}

                            {userStatus.connectedWalletInfo ? (
                                <div className="relative group">
                                    <button
                                        onClick={() => navigate('walletDashboard')}
                                        className="px-4 py-2 text-sm font-semibold bg-binance-green text-white rounded-lg hover:bg-green-600 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-binance-green"
                                    >
                                        Wallet Connected
                                    </button>
                                    <div className="absolute right-0 mt-2 w-48 bg-binance-bg-secondary rounded-lg shadow-xl py-1 hidden group-hover:block transition-all duration-300 origin-top-right border border-binance-border">
                                        <div className="px-4 py-2 text-sm text-binance-text-muted break-all">
                                            {/* Display truncated address or username */}
                                            {userStatus.connectedWalletInfo.address ?
                                                `${userStatus.connectedWalletInfo.address.substring(0, 6)}...${userStatus.connectedWalletInfo.address.substring(userStatus.connectedWalletInfo.address.length - 4)}`
                                                : userStatus.connectedWalletInfo.username}
                                        </div>
                                        <button
                                            onClick={handleDisconnectWallet}
                                            className="block w-full text-left px-4 py-2 text-sm text-binance-red hover:bg-binance-surface-elevated transition-colors duration-200"
                                        >
                                            Disconnect
                                        </button>
                                    </div>
                                </div>
                            ) : (
                                <button
                                    onClick={() => navigate('walletConnectPage')}
                                    className="px-4 py-2 text-sm font-semibold bg-binance-accent-yellow text-binance-bg-primary rounded-lg hover:opacity-90 transition-opacity duration-200 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                >
                                    Connect Wallet
                                </button>
                            )}

                            {userStatus.isLoggedIn && (
                                <button
                                    onClick={() => navigate('settingsPage')}
                                    className="px-4 py-2 text-sm font-semibold text-binance-text-light rounded-lg hover:bg-binance-surface-elevated transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                >
                                    Settings
                                </button>
                            )}
                            <DarkModeToggle isDarkMode={isDarkMode} toggleDarkMode={toggleDarkMode} />
                        </div>
                    </nav>
                </header>
            );
        };

        // Footer component with site navigation and copyright
        const Footer = () => (
            <footer className="bg-binance-bg-secondary py-10 text-binance-text-muted transition-colors duration-300">
                <div className="container mx-auto px-4 grid grid-cols-1 md:grid-cols-4 gap-8">
                    {/* Brand information and social links */}
                    <div className="space-y-4">
                        <div className="flex items-center space-x-2">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/4/4c/Binance_Logo.svg" alt="Binance Logo" className="w-8 h-8" />
                            <span className="text-lg font-bold text-binance-text-light">Binance Web3 Wallet</span>
                        </div>
                        <p className="text-sm">Your secure gateway to the decentralized world.</p>
                        <div className="flex space-x-4 text-xl">
                            {/* Social media icons (SVG for better control and performance) */}
                            <a href="#" className="hover:text-binance-accent-yellow transition-colors duration-200" aria-label="Twitter">
                                <svg fill="currentColor" viewBox="0 0 24 24" aria-hidden="true" className="w-6 h-6"><path d="M22.1 5.09a8.38 8.38 0 01-2.45.67A4.2 4.2 0 0022 2.7c-.82.49-1.73.84-2.69 1.05a4.18 4.18 0 00-7.1 3.81 11.83 11.83 0 01-8.6-4.36A4.19 4.19 0 001 7.21c.01 1.45.74 2.73 1.88 3.49a4.17 4.17 0 01-1.89-.52v.05c0 2.05 1.46 3.76 3.39 4.15a4.2 4.2 0 01-1.88.07c.54 1.68 2.1 2.91 3.96 2.94A8.44 8.44 0 012 19.33a11.97 11.97 0 006.49 1.9c7.79 0 12.04-6.46 12.04-12.04C20.53 7.82 21.37 6.9 22.1 5.09z"></path></svg>
                            </a>
                            <a href="#" className="hover:text-binance-accent-yellow transition-colors duration-200" aria-label="LinkedIn">
                                <svg fill="currentColor" viewBox="0 0 24 24" aria-hidden="true" className="w-6 h-6"><path d="M20.447 20.452h-3.554v-5.564c0-1.373-.027-3.14-1.914-3.14-1.917 0-2.21 1.498-2.21 3.037v5.667H9.227V9.333h3.414v1.543h.047c.477-.905 1.64-1.859 3.364-1.859 3.601 0 4.267 2.378 4.267 5.467v6.188zM5.447 7.88c-1.124 0-2.037-.914-2.037-2.041 0-1.127.913-2.041 2.037-2.041 1.127 0 2.04.914 2.04 2.041 0 1.127-.913 2.041-2.04 2.041zM7.21 20.452H3.554V9.333H7.21v11.119z"></path></svg>
                            </a>
                            <a href="#" className="hover:text-binance-accent-yellow transition-colors duration-200" aria-label="Telegram">
                                <svg fill="currentColor" viewBox="0 0 24 24" aria-hidden="true" className="w-6 h-6"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.33 7.51L10.5 14.28c-.28.27-.66.42-1.07.42-.41 0-.79-.15-1.07-.42l-2.83-2.73c-.56-.54-.56-1.42 0-1.96.56-.54 1.46-.54 2.02 0l1.82 1.76 4.83-4.66c.56-.54 1.46-.54 2.02 0 .56.54.56 1.42 0 1.96z"></path></svg>
                            </a>
                        </div>
                    </div>

                    {/* Product Links */}
                    <div>
                        <h4 className="font-semibold text-binance-text-light mb-4">Products</h4>
                        <ul className="space-y-2 text-sm">
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Wallet App functionality details.'); }} className="hover:text-binance-accent-yellow transition-colors duration-200">Wallet App</a></li>
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Exchange details and features.'); }} className="hover:text-binance-accent-yellow transition-colors duration-200">Exchange</a></li>
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('NFT Marketplace browsing and trading.'); }} className="hover:text-binance-accent-yellow transition-colors duration-200">NFT Marketplace</a></li>
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Staking options for passive income.'); }} className="hover:text-binance-accent-yellow transition-colors duration-200">Staking</a></li>
                        </ul>
                    </div>

                    {/* Company Links */}
                    <div>
                        <h4 className="font-semibold text-binance-text-light mb-4">Company</h4>
                        <ul className="space-y-2 text-sm">
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Information about Binance Web3 Wallet.'); }} className="hover:text-binance-accent-yellow transition-colors duration-200">About Us</a></li>
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Career opportunities at Binance.'); }} className="hover:text-binance-accent-yellow transition-colors duration-200">Careers</a></li>
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Read our latest blog posts.'); }} className="hover:text-binance-accent-yellow transition-colors duration-200">Blog</a></li>
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Details on our partnership programs.'); }} className="hover:text-binance-accent-yellow transition-colors duration-200">Partnerships</a></li>
                        </ul>
                    </div>

                    {/* Support Links */}
                    <div>
                        <h4 className="font-semibold text-binance-text-light mb-4">Support</h4>
                        <ul className="space-y-2 text-sm">
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Access the Help Center for assistance.'); }} className="hover:text-binance-accent-yellow transition-colors duration-200">Help Center</a></li>
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Contact our support team directly.'); }} className="hover:text-binance-accent-yellow transition-colors duration-200">Contact Us</a></li>
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Join our community forums.'); }} className="hover:text-binance-accent-yellow transition-colors duration-200">Community</a></li>
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Review legal terms and policies.'); }} className="hover:text-binance-accent-yellow transition-colors duration-200">Legal</a></li>
                        </ul>
                    </div>
                </div>
                <div className="border-t border-binance-border mt-8 pt-6 text-center text-sm">
                    &copy; 2025 Binance Web3 Wallet. All rights reserved.
                </div>
            </footer>
        );

        // Component for rendering a Lightweight Chart (simulating TradingView)
        const TradingViewChart = ({ data, coinSymbol }) => {
            const chartContainerRef = useRef(); // Ref to the chart container DOM element
            const chartRef = useRef(null); // Ref to the LightweightCharts instance
            const seriesRef = useRef(null); // Ref to the chart series (e.g., AreaSeries)

            useEffect(() => {
                // Check if the container and library are available
                if (!chartContainerRef.current || !window.LightweightCharts) {
                    console.warn("Chart container not ready or LightweightCharts not loaded yet. Skipping chart creation.");
                    return;
                }

                // Function to handle chart resizing, adapting to container width
                const handleResize = () => {
                    if (chartRef.current) {
                        chartRef.current.applyOptions({ width: chartContainerRef.current.clientWidth });
                    }
                };

                // Dispose of any existing chart instance to prevent memory leaks or multiple charts
                if (chartRef.current) {
                    chartRef.current.remove();
                    chartRef.current = null;
                    seriesRef.current = null;
                }

                // Create a new chart instance
                const chart = window.LightweightCharts.createChart(chartContainerRef.current, {
                    width: chartContainerRef.current.clientWidth, // Set initial width based on container
                    height: 300, // Fixed height for the chart
                    layout: {
                        // Dynamic background and text color based on dark mode
                        backgroundColor: '#1A1D20', // Explicitly Binance dark primary for chart background
                        textColor: '#F0F4F8', // Explicitly Binance light text for chart text
                    },
                    grid: {
                        // Grid line colors for better visual clarity
                        vertLines: {
                            color: '#2E353C', // Binance surface elevated for grid lines
                        },
                        horzLines: {
                            color: '#2E353C', // Binance surface elevated for grid lines
                        },
                    },
                    rightPriceScale: {
                        borderColor: '#3D4955', // Binance border for price scale
                    },
                    timeScale: {
                        borderColor: '#3D4955', // Binance border for time scale
                        timeVisible: true,
                        secondsVisible: false,
                    },
                });

                chartRef.current = chart; // Store the chart instance

                // Add an area series to the chart
                const newSeries = chart.addAreaSeries({
                    topColor: 'rgba(252, 213, 53, 0.5)', // Top part of the area fill (Binance yellow with opacity)
                    bottomColor: 'rgba(252, 213, 53, 0.05)', // Bottom part of the area fill
                    lineColor: '#FCD535', // Line color (Binance yellow)
                    lineWidth: 2, // Line thickness
                });
                seriesRef.current = newSeries; // Store the series instance

                // Set data to the series if provided
                if (data && data.length > 0) {
                    newSeries.setData(data);
                }

                // Add resize event listener to adapt chart to window size changes
                window.addEventListener('resize', handleResize);

                // Cleanup function: remove event listener and dispose chart instance on component unmount
                return () => {
                    window.removeEventListener('resize', handleResize);
                    if (chartRef.current) {
                        chartRef.current.remove();
                        chartRef.current = null;
                        seriesRef.current = null;
                    }
                };
            }, [data, coinSymbol]); // Dependencies for useEffect: re-run if data or coinSymbol changes

            return (
                <div ref={chartContainerRef} className="w-full h-[300px]">
                    {/* The chart will be rendered inside this div */}
                </div>
            );
        };


        // Landing Page: The initial page, minimalist with key action buttons.
        const LandingPage = ({ navigate }) => {
            const handleGetAppClick = () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            showModal('Binance Web3 Wallet PWA installation accepted!');
                        } else {
                            showModal('Binance Web3 Wallet PWA installation dismissed.');
                        }
                        deferredPrompt = null;
                    });
                } else {
                    showModal('PWA installation prompt not available. You might need to add to home screen manually.');
                    console.log('No deferredPrompt available.');
                }
            };

            return (
                <div className="min-h-screen pt-16 bg-binance-bg-primary text-binance-text-light transition-colors duration-300 flex items-center justify-center">
                    <section className="relative w-full text-white pt-24 pb-32 text-center overflow-hidden">
                        <div className="container mx-auto px-4 relative z-10">
                            <h1 className="text-4xl sm:text-5xl lg:text-6xl font-extrabold leading-tight mb-4">
                                Buy, Trade, and Hold Crypto
                            </h1>
                            <p className="text-lg sm:text-xl text-white opacity-90 mb-8 max-w-3xl mx-auto">
                                The world’s largest crypto exchange trusted by millions.
                            </p>
                            <div className="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-4">
                                {/* Get App Button */}
                                <button
                                    onClick={handleGetAppClick}
                                    className="px-8 py-4 w-48 bg-gray-700 text-white font-semibold text-lg rounded-lg shadow-binance-md hover:bg-gray-600 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:ring-offset-binance-bg-primary"
                                >
                                    Get App
                                </button>
                                {/* Login Button */}
                                <button
                                    onClick={() => navigate('loginPage')}
                                    className="px-8 py-4 w-48 bg-binance-accent-yellow text-binance-bg-primary font-semibold text-lg rounded-lg shadow-binance-md hover:opacity-90 transition-opacity duration-200 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow focus:ring-offset-2 focus:ring-offset-binance-bg-primary"
                                >
                                    Login
                                </button>
                                {/* Connect Wallet Button */}
                                <button
                                    onClick={() => navigate('walletConnectPage')}
                                    className="px-8 py-4 w-48 border border-white text-white font-semibold text-lg rounded-lg shadow-binance-md hover:bg-white hover:text-binance-blue transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-binance-bg-primary"
                                >
                                    Connect Wallet
                                </button>
                            </div>
                        </div>
                        {/* Binance-like background gradient matching the provided link */}
                        <div className="absolute inset-0 bg-gradient-to-br from-binance-blue/50 to-purple-700/50 opacity-50 blur-3xl"></div>
                        <div className="absolute inset-0 bg-gradient-to-br from-blue-900/10 via-purple-900/10 to-teal-900/10 opacity-70"></div>
                    </section>
                </div>
            );
        };

        // Home Page: The main dashboard after a user logs in and connects wallet
        const HomePage = ({ navigate }) => {
            const { userStatus } = useContext(UserContext); // Access user status from context
            const displayAddress = userStatus.connectedWalletInfo?.address || userStatus.connectedWalletInfo?.username || 'Not Connected';
            const displayBalance = userStatus.connectedWalletInfo?.balance || '0.00 USD'; // Default balance if no wallet connected

            // State for market data, news, and chart data, along with loading indicators
            const [marketData, setMarketData] = useState([]);
            const [newsData, setNewsData] = useState([]);
            const [chartData, setChartData] = useState([]);
            const [loadingMarket, setLoadingMarket] = useState(true);
            const [loadingNews, setLoadingNews] = useState(true);

            // Fetch market data from CoinGecko API and simulate news/chart data
            useEffect(() => {
                const fetchMarketData = async () => {
                    setLoadingMarket(true);
                    try {
                        // Fetching top 10 coins by market cap from CoinGecko
                        const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&page=1&sparkline=false&price_change_percentage=24h');
                        const data = await response.json();
                        setMarketData(data.map(coin => ({
                            symbol: coin.symbol.toUpperCase(),
                            name: coin.name,
                            price: coin.current_price.toLocaleString('en-US', { style: 'currency', currency: 'USD' }),
                            change: coin.price_change_percentage_24h ? coin.price_change_percentage_24h.toFixed(2) : '0.00',
                            isPositive: coin.price_change_percentage_24h >= 0,
                            image: coin.image
                        })));

                        // Simulated chart data for BTC (for demonstration, similar to TradingView)
                        const simulatedChartData = Array.from({ length: 30 }, (_, i) => {
                            const date = new Date();
                            date.setDate(date.getDate() - (29 - i)); // Dates for the last 30 days
                            const value = 60000 + Math.sin(i * 0.5) * 5000 + Math.random() * 2000; // Sine wave with randomness
                            return { time: date.toISOString().slice(0, 10), value: parseFloat(value.toFixed(2)) };
                        });
                        setChartData(simulatedChartData);

                    } catch (error) {
                        console.error("Error fetching market data:", error);
                        showModal("Failed to fetch market data. Please try again later.");
                    } finally {
                        setLoadingMarket(false);
                    }
                };

                // Simulated News Data (as CoinGecko free API doesn't provide news)
                const fetchNewsData = () => {
                    setLoadingNews(true);
                    setTimeout(() => {
                        setNewsData([
                            { title: "Bitcoin Price Reaches New All-Time High!", source: "CoinDesk", date: "2 hours ago" },
                            { title: "Ethereum Upgrade Successfully Deployeds", source: "Decrypt", date: "5 hours ago" },
                            { title: "DeFi Sector Sees Major Inflows", source: "The Block", date: "1 day ago" },
                            { title: "New Regulations Proposed for Stablecoins", source: "Bloomberg Crypto", date: "2 days ago" },
                        ]);
                        setLoadingNews(false);
                    }, 1000); // Simulate network delay
                };

                fetchMarketData(); // Initial fetch
                fetchNewsData(); // Initial fetch

                // Refresh market data periodically
                const marketDataInterval = setInterval(fetchMarketData, 5 * 60 * 1000); // Every 5 minutes
                return () => clearInterval(marketDataInterval); // Cleanup on component unmount
            }, []); // Empty dependency array means this runs once on mount

            // Component for displaying individual market cards
            const MarketCard = ({ symbol, name, price, change, isPositive, image }) => (
                <div className="bg-binance-bg-secondary p-4 rounded-lg shadow-binance-sm border border-binance-border flex flex-col items-center justify-center text-center">
                    {image && <img src={image} alt={`${name} icon`} className="w-8 h-8 mb-2" />}
                    <div className="text-xl font-bold text-binance-text-light">{symbol}</div>
                    <div className="text-sm text-binance-text-muted mb-2">{name}</div>
                    <div className="text-lg font-semibold text-binance-text-light mb-1">{price}</div>
                    <div className={`text-sm ${isPositive ? 'text-binance-green' : 'text-binance-red'}`}>{change}%</div>
                </div>
            );

            // Component for quick action buttons with icons
            const QuickActionBtn = ({ text, onClick, icon }) => (
                <button
                    onClick={onClick}
                    className="flex flex-col items-center justify-center p-4 bg-binance-bg-secondary rounded-lg shadow-binance-sm hover:bg-binance-surface-elevated transition-colors duration-200"
                >
                    {icon && <span className="mb-2 text-2xl text-binance-accent-yellow">{icon}</span>}
                    <span className="text-sm font-medium text-binance-text-light">{text}</span>
                </button>
            );

            return (
                <div className="min-h-screen bg-binance-bg-primary pt-16 transition-colors duration-300">
                    <div className="container mx-auto px-4 py-8">
                        {/* Binance-style Hero/Banner Section */}
                        <section className="bg-gradient-to-r from-binance-blue to-purple-700 text-white p-8 md:p-12 rounded-xl shadow-binance-lg mb-8 flex flex-col md:flex-row items-center justify-between text-center md:text-left">
                            <div className="mb-6 md:mb-0">
                                <h1 className="text-3xl sm:text-4xl lg:text-5xl font-extrabold leading-tight mb-3">
                                    Trade Crypto Safely and Smartly
                                </h1>
                                <p className="text-lg sm:text-xl text-white opacity-90 max-w-2xl mx-auto md:mx-0">
                                    Join the world's largest crypto exchange. Fast, secure, and user-friendly.
                                </p>
                            </div>
                            <div className="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                                <button
                                    onClick={() => navigate('loginPage')}
                                    className="px-6 py-3 w-40 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200 shadow-binance-md"
                                >
                                    Login / Register
                                </button>
                                <button
                                    onClick={() => navigate('walletConnectPage')}
                                    className="px-6 py-3 w-40 border border-white text-white font-semibold rounded-lg hover:bg-white hover:text-binance-blue transition-colors duration-200 shadow-binance-md"
                                >
                                    Connect Wallet
                                </button>
                            </div>
                        </section>

                        {/* Connection Status & Balance */}
                        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg mb-8 flex flex-col sm:flex-row justify-between items-center text-binance-text-light border border-binance-border">
                            <div>
                                <h2 className="text-2xl font-bold mb-2">Your Wallet Overview</h2>
                                {userStatus.isLoggedIn ? (
                                    userStatus.connectedWalletInfo ? (
                                        <p className="text-lg">
                                            Wallet: <span className="font-semibold text-binance-accent-yellow">
                                                {/* Display truncated address or username */}
                                                {displayAddress.length > 20 ? `${displayAddress.substring(0, 10)}...${displayAddress.substring(displayAddress.length - 8)}` : displayAddress}
                                            </span>
                                        </p>
                                    ) : (
                                        <p className="text-lg">Logged in, but no wallet connected.</p>
                                    )
                                ) : (
                                    <p className="text-lg">Please log in or connect your wallet to see details.</p>
                                )}
                            </div>
                            <div className="mt-4 sm:mt-0 text-right">
                                <h3 className="text-xl font-semibold text-binance-text-muted">Total Balance (Est.)</h3>
                                <p className="text-3xl font-bold text-binance-accent-yellow">{displayBalance}</p>
                            </div>
                        </div>

                        {/* Quick Actions Section */}
                        <div className="mb-8 bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg border border-binance-border">
                            <h2 className="text-2xl font-bold text-binance-text-light mb-4">Quick Actions</h2>
                            <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                                <QuickActionBtn text={"Buy Crypto"} onClick={() => navigate('walletDashboard')} icon="💰" />
                                <QuickActionBtn text={"Deposit"} onClick={() => navigate('walletDashboard')} icon="📥" />
                                <QuickActionBtn text={"Withdraw"} onClick={() => navigate('walletDashboard')} icon="📤" />
                                <QuickActionBtn text={"Trade"} onClick={() => navigate('walletDashboard')} icon="💹" />
                                <QuickActionBtn text={"Convert"} onClick={() => navigate('walletDashboard')} icon="💱" />
                                <QuickActionBtn text={"Earn"} onClick={() => navigate('walletDashboard')} icon="📈" />
                            </div>
                        </div>

                        {/* Market Overview Section with Live Data */}
                        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg mb-8 border border-binance-border">
                            <h2 className="text-2xl font-bold text-binance-text-light mb-4">Market Overview</h2>
                            {loadingMarket ? (
                                <div className="text-center py-8 text-binance-text-muted">Loading market data...</div>
                            ) : (
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                                    {marketData.map((data, index) => (
                                        <MarketCard key={index} {...data} />
                                    ))}
                                </div>
                            )}
                            <div className="text-right mt-4">
                                <button onClick={() => navigate('homePage')} className="text-binance-accent-yellow hover:underline font-medium">View More Markets</button>
                            </div>
                        </div>

                        {/* Live Chart Performance Section */}
                        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg mb-8 border border-binance-border">
                             <h2 className="text-2xl font-bold text-binance-text-light mb-4">BTC/USDT Live Chart</h2>
                             {loadingMarket ? (
                                <div className="text-center py-8 text-binance-text-muted">Loading chart data...</div>
                            ) : (
                                <TradingViewChart data={chartData} coinSymbol="BTC" />
                            )}
                        </div>

                        {/* Market News Section (Simulated) */}
                        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg border border-binance-border">
                            <h2 className="text-2xl font-bold text-binance-text-light mb-4">Latest Crypto News</h2>
                            {loadingNews ? (
                                <div className="text-center py-8 text-binance-text-muted">Loading news...</div>
                            ) : (
                                <ul className="space-y-4">
                                    {newsData.map((news, index) => (
                                        <li key={index} className="border-b border-binance-border pb-3 last:border-b-0">
                                            <a href="#" onClick={(e) => { e.preventDefault(); showModal(`News Article: ${news.title}`); }} className="block text-binance-text-light hover:text-binance-accent-yellow font-medium text-lg">
                                                {news.title}
                                            </a>
                                            <p className="text-sm text-binance-text-muted">{news.source} • {news.date}</p>
                                        </li>
                                    ))}
                                </ul>
                            )}
                            <div className="text-right mt-4">
                                <button onClick={() => navigate('homePage')} className="text-binance-accent-yellow hover:underline font-medium">View All News</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Login Page: User authentication form
        const LoginPage = ({ navigate, setUserStatus }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const handleLogin = (e) => {
                e.preventDefault(); // Prevent default form submission
                setIsLoading(true);
                showModal('Logging in...');

                setTimeout(() => {
                    setIsLoading(false);
                    hideModal();
                    // Simulate successful login, no wallet connected initially
                    setUserStatus(prevStatus => ({ ...prevStatus, isLoggedIn: true }));
                    navigate('walletConnectPage'); // After login, user is directed to Connect Wallet page
                }, 3000); // Simulate login delay
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 transition-colors duration-300 p-4">
                    <div className="bg-binance-bg-secondary p-8 rounded-xl shadow-binance-lg w-11/12 max-w-md border border-binance-border">
                        <h2 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Log In</h2>
                        <form onSubmit={handleLogin}>
                            <div className="mb-4">
                                <label htmlFor="email" className="block text-binance-text-light text-sm font-medium mb-2">Email / Mobile</label>
                                <input
                                    type="text"
                                    id="email"
                                    className="w-full px-4 py-3 rounded-lg bg-binance-surface-elevated text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                    placeholder="Enter email or mobile"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    required
                                />
                            </div>
                            <div className="mb-6">
                                <label htmlFor="password" className="block text-binance-text-light text-sm font-medium mb-2">Password</label>
                                <input
                                    type="password"
                                    id="password"
                                    className="w-full px-4 py-3 rounded-lg bg-binance-surface-elevated text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                    placeholder="Enter password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                />
                            </div>
                            <button
                                type="submit"
                                className="w-full px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg shadow-binance-md hover:opacity-90 transition-opacity duration-200 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                disabled={isLoading}
                            >
                                {isLoading ? (
                                    <span className="flex items-center justify-center">
                                        <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-binance-bg-primary mr-3"></div>
                                        Logging In...
                                    </span>
                                ) : 'Log In'}
                            </button>
                            <p className="text-center text-sm text-binance-text-muted mt-4">
                                {/* "Register Now" redirects to login page with a message, as no separate registration flow is intended */}
                                Don't have an account? <a href="#" onClick={(e) => { e.preventDefault(); showModal('This would typically lead to a registration form in a full application. For this demo, please use the login above.'); }} className="text-binance-accent-yellow hover:underline">Register Now</a>
                            </p>
                        </form>
                    </div>
                </div>
            );
        };

        // Wallet Connect Page: Allows connecting via WalletConnect or manually
        const WalletConnectPage = ({ navigate, setUserStatus }) => {
            const { userStatus } = useContext(UserContext);
            const [activeSection, setActiveSection] = useState('walletconnect'); // Manages tabs: 'walletconnect' or 'manual'
            const [walletConnectStatus, setWalletConnectStatus] = useState("Connect your Ethereum wallet via WalletConnect.");
            const [connectedAddress, setConnectedAddress] = useState(userStatus.connectedWalletInfo?.address || '');
            const [isWalletConnectLoading, setIsWalletConnectLoading] = useState(false);
            const [isManualLoading, setIsManualLoading] = useState(false);

            // States for manual connection
            const [selectedNetworkId, setSelectedNetworkId] = useState('');
            const [manualAddressInput, setManualAddressInput] = useState('');
            const [manualNetworkDisplay, setManualNetworkDisplay] = useState(userStatus.connectedWalletInfo?.network || '');
            const [manualAddressDisplay, setManualAddressDisplay] = useState(userStatus.connectedWalletInfo?.address || '');
            const [manualBalanceDisplay, setManualBalanceDisplay] = useState(userStatus.connectedWalletInfo?.balance || '');
            const [showManualConnectInfo, setShowManualConnectInfo] = useState(!!userStatus.connectedWalletInfo);

            // Effect to update local state if userStatus changes externally (e.g., disconnect from header)
            useEffect(() => {
                if (!userStatus.connectedWalletInfo) {
                    setConnectedAddress('');
                    setWalletConnectStatus("Connect your Ethereum wallet via WalletConnect.");
                    setManualNetworkDisplay('');
                    setManualAddressDisplay('');
                    setManualBalanceDisplay('');
                    setShowManualConnectInfo(false);
                } else {
                    setConnectedAddress(userStatus.connectedWalletInfo.address || '');
                    setManualNetworkDisplay(userStatus.connectedWalletInfo.network || '');
                    setManualAddressDisplay(userStatus.connectedWalletInfo.address || '');
                    setManualBalanceDisplay(userStatus.connectedWalletInfo.balance || '');
                    setShowManualConnectInfo(true);
                    // Set the active tab based on how the wallet was last connected
                    if (userStatus.connectedWalletInfo.type === 'manual') {
                        setActiveSection('manual');
                    } else {
                        setActiveSection('walletconnect');
                    }
                }
            }, [userStatus.connectedWalletInfo]);

            // List of supported networks for manual connection
            const networks = [
                { id: 'btc', name: 'Bitcoin (BTC)', type: 'non-evm', symbol: 'BTC', api: 'https://api.blockcypher.com/v1/btc/main/addrs/' },
                { id: 'eth-erc20', name: 'Ethereum (ETH ERC20)', type: 'evm', symbol: 'ETH', rpc: 'https://mainnet.infura.io/v3/YOUR_INFURA_PROJECT_ID' },
                { id: 'bnb-bep20', name: 'BNB Smart Chain (BSC BEP20)', type: 'evm', symbol: 'BNB', rpc: 'https://bsc-dataseed.binance.org/' },
                { id: 'tron-trc20', name: 'TRON (TRX TRC20)', type: 'non-evm', symbol: 'TRX', api: 'https://api.trongrid.io/wallet/getaccount' },
                { id: 'sol', name: 'Solana (SOL)', type: 'non-evm', symbol: 'SOL', rpc: 'https://api.mainnet-beta.solana.com' },
                { id: 'polygon', name: 'Polygon (MATIC)', type: 'evm', symbol: 'MATIC', rpc: 'https://polygon-rpc.com/' },
                { id: 'avalanche', name: 'Avalanche C-Chain (AVAX)', type: 'evm', symbol: 'AVAX', rpc: 'https://api.avax.network/ext/bc/C/rpc' },
                { id: 'arbitrum', name: 'Arbitrum One (ARB)', type: 'evm', symbol: 'ETH', rpc: 'https://arb1.arbitrum.io/rpc' },
                { id: 'optimism', name: 'Optimism (OP)', type: 'evm', symbol: 'ETH', rpc: 'https://mainnet.optimism.io' },
                { id: 'fantom', name: 'Fantom (FTM)', type: 'evm', symbol: 'FTM', rpc: 'https://rpc.ftm.tools/' },
                { id: 'polkadot', name: 'Polkadot (DOT)', type: 'non-evm', symbol: 'DOT', api: 'N/A' },
                { id: 'cosmos', name: 'Cosmos (ATOM)', type: 'non-evm', symbol: 'ATOM', api: 'N/A' },
                { id: 'cardano', name: 'Cardano (ADA)', type: 'non-evm', symbol: 'ADA', api: 'N/A' },
                { id: 'xrp', name: 'XRP Ledger (XRP)', type: 'non-evm', symbol: 'XRP', api: 'N/A' },
                { id: 'near', name: 'Near Protocol (NEAR)', type: 'non-evm', symbol: 'NEAR', api: 'N/A' }
            ];

            // --- WalletConnect Logic ---
            const handleConnectWallet = async () => {
                // Ensure user is logged in before allowing WalletConnect
                if (!userStatus.isLoggedIn) {
                    showModal('Please log in first to connect your wallet.');
                    navigate('loginPage'); // Redirect to login if not logged in
                    return;
                }

                setIsWalletConnectLoading(true);
                setWalletConnectStatus('Connecting...');
                showModal('Opening WalletConnect modal to connect your wallet...');

                try {
                    // Initialize WalletConnectProvider with your project ID
                    const provider = new WalletConnectProvider.default({
                        projectId: "0e0d74e5227e248cffdc16006c9e7e2f", // Replace with your actual WalletConnect Project ID
                        chains: [1], // Example: Ethereum Mainnet (chain ID)
                        infuraId: "YOUR_INFURA_PROJECT_ID", // Replace with your Infura Project ID for EVM chains
                        showQrModal: true // Display QR modal for connection
                    });

                    await provider.enable(); // Enable connection
                    const web3 = new Web3(provider); // Initialize Web3.js with the provider
                    const accounts = await web3.eth.getAccounts(); // Get connected accounts

                    if (accounts.length > 0) {
                        const account = accounts[0];
                        setConnectedAddress(account);
                        setWalletConnectStatus('You\'re connected!');
                        showModal(`Successfully connected wallet: ${account}`);
                        // Simulate balance fetch for demonstration
                        const simulatedBalance = '0.12345 ETH';
                        setUserStatus(prevStatus => ({ ...prevStatus, connectedWalletInfo: { address: account, balance: simulatedBalance, network: 'Ethereum', type: 'walletconnect' } }));
                        navigate('homePage'); // After successful wallet connection (and assumed login), navigate to homepage
                    } else {
                        showModal("No accounts found. Please try connecting again.");
                        setWalletConnectStatus("Failed to connect wallet.");
                    }
                } catch (error) {
                    console.error("Wallet connection failed:", error);
                    let errorMessage = "An unknown error occurred.";
                    if (error.message && error.message.includes("User closed modal")) {
                        errorMessage = "WalletConnect modal was closed. Please try again to connect.";
                    } else if (error.message) {
                        errorMessage = error.message;
                    } else if (error.code) {
                        errorMessage = `Error Code: ${error.code}`;
                    }
                    showModal(`Connection Error: ${errorMessage}. Please try again.`);
                    setWalletConnectStatus("Failed to connect wallet.");
                } finally {
                    setIsWalletConnectLoading(false);
                    hideModal();
                }
            };

            const handleDisconnectWallet = () => {
                showModal('Disconnecting wallet...');
                setTimeout(() => {
                    setUserStatus(prevStatus => ({ ...prevStatus, connectedWalletInfo: null })); // Clear wallet info
                    showModal('Wallet disconnected!');
                    hideModal();
                }, 1500);
            };

            // --- Manual Connect Logic ---
            const handleFetchBalance = async () => {
                // Ensure user is logged in before allowing Manual Connect
                if (!userStatus.isLoggedIn) {
                    showModal('Please log in first to connect your wallet manually.');
                    navigate('loginPage'); // Redirect to login if not logged in
                    return;
                }

                const address = manualAddressInput.trim();
                if (!selectedNetworkId) {
                    showModal('Please select a network.');
                    return;
                }
                if (!address) {
                    showModal('Please enter a wallet address.');
                    return;
                }

                setIsManualLoading(true);
                setShowManualConnectInfo(false); // Hide previous info while loading
                showModal('Fetching balance, please wait...');

                const network = networks.find(n => n.id === selectedNetworkId);
                let balance = 'N/A';
                try {
                    await new Promise(resolve => setTimeout(resolve, 2000)); // Simulate API call delay

                    if (network.type === 'evm') {
                        if (!network.rpc || network.rpc.includes('YOUR_INFURA_PROJECT_ID')) {
                            showModal(`Please replace 'YOUR_INFURA_PROJECT_ID' with a valid Infura ID for EVM network RPC access. (Simulated Balance)`);
                            balance = 'RPC Not Configured (Simulated)';
                        } else {
                            // In a real app, you'd use Web3.js with the RPC here to get actual balance
                            // const web3 = new Web3(new Web3.providers.HttpProvider(network.rpc));
                            // const weiBalance = await web3.eth.getBalance(address);
                            // balance = web3.utils.fromWei(weiBalance, 'ether') + ` ${network.symbol}`;
                            balance = `${(Math.random() * 5).toFixed(4)} ${network.symbol} (Simulated)`;
                        }
                    } else { // Non-EVM chains - simplified simulation
                        balance = `${(Math.random() * 1000).toFixed(2)} ${network.symbol} (Simulated)`;
                    }
                } catch (error) {
                    console.error(`Error fetching balance for ${network.name}:`, error);
                    balance = 'Error (Simulated)';
                    showModal(`Error fetching balance for ${network.name}: ${error.message || error}.`);
                } finally {
                    setManualNetworkDisplay(network.name);
                    setManualAddressDisplay(address);
                    setManualBalanceDisplay(balance);
                    setShowManualConnectInfo(true);
                    setIsManualLoading(false);
                    hideModal(); // Hide fetching modal

                    // Update user status with manual connection info
                    setUserStatus(prevStatus => ({ ...prevStatus, connectedWalletInfo: { address: address, balance: balance, network: network.name, type: 'manual' } }));
                    navigate('homePage'); // Navigate to dashboard after successful connection
                }
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 p-4 transition-colors duration-300">
                    <div className="bg-binance-bg-secondary p-8 rounded-2xl shadow-binance-lg max-w-md w-full text-center border border-binance-border">
                        <h1 className="text-3xl font-extrabold text-binance-text-light mb-6">Wallet Connection Options</h1>

                        {/* Tab toggle buttons */}
                        <div className="flex justify-center gap-4 mb-6">
                            <button
                                onClick={() => setActiveSection('walletconnect')}
                                className={`px-6 py-3 rounded-xl font-semibold shadow-binance-md transition duration-300 ${activeSection === 'walletconnect' ? 'bg-binance-accent-yellow text-binance-bg-primary' : 'bg-binance-surface-elevated text-binance-text-light hover:bg-gray-700'}`}
                            >
                                WalletConnect
                            </button>
                            <button
                                onClick={() => setActiveSection('manual')}
                                className={`px-6 py-3 rounded-xl font-semibold shadow-binance-md transition duration-300 ${activeSection === 'manual' ? 'bg-binance-accent-yellow text-binance-bg-primary' : 'bg-binance-surface-elevated text-binance-text-light hover:bg-gray-700'}`}
                            >
                                Manual Connect
                            </button>
                        </div>

                        <hr className="my-6 border-binance-border" />

                        {/* WalletConnect Section Content */}
                        {activeSection === 'walletconnect' && (
                            <div className="flex flex-col items-center">
                                <div id="status-message" className="mb-6 text-lg text-binance-text-muted">
                                    {walletConnectStatus}
                                </div>
                                {/* Conditionally render connect button or connected info */}
                                {!userStatus.connectedWalletInfo || userStatus.connectedWalletInfo.type !== 'walletconnect' ? (
                                    <button
                                        onClick={handleConnectWallet}
                                        className="bg-binance-accent-yellow hover:opacity-90 text-binance-bg-primary font-bold py-3 px-6 rounded-xl shadow-binance-md
                                                   transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-binance-accent-yellow
                                                   w-full flex items-center justify-center gap-2"
                                        disabled={isWalletConnectLoading || !userStatus.isLoggedIn}
                                    >
                                        {isWalletConnectLoading ? (
                                            <span className="flex items-center justify-center">
                                                <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-binance-bg-primary mr-3"></div>
                                                Connecting...
                                            </span>
                                        ) : (
                                            <>
                                                <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                    <path fillRule="evenodd" d="M3 8a2 2 0 012-2h10a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8zm5-3a1 1 0 00-1 1v2a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd"></path>
                                                </svg>
                                                Connect Wallet
                                            </>
                                        )}
                                    </button>
                                ) : (
                                    <div className="mt-8 p-4 bg-binance-surface-elevated border border-binance-border rounded-xl w-full">
                                        <h2 className="text-xl font-semibold text-binance-text-light mb-2">Wallet Connected!</h2>
                                        <p className="text-binance-text-muted break-all">
                                            <span className="font-medium">Address:</span> <span className="text-binance-accent-yellow font-mono">{connectedAddress}</span>
                                        </p>
                                        <p className="text-binance-text-muted break-all mt-1">
                                            <span className="font-medium">Balance:</span> <span className="text-binance-accent-yellow font-mono">{userStatus.connectedWalletInfo.balance}</span>
                                        </p>
                                        <button
                                            onClick={handleDisconnectWallet}
                                            className="mt-4 w-full px-4 py-2 bg-binance-red text-white font-semibold rounded-lg hover:bg-red-600 transition-colors duration-200"
                                        >
                                            Disconnect Wallet
                                        </button>
                                    </div>
                                )}
                                {!userStatus.isLoggedIn && (
                                    <p className="text-sm text-binance-text-muted mt-4">
                                        Please <a href="#" onClick={(e) => { e.preventDefault(); navigate('loginPage'); }} className="text-binance-accent-yellow hover:underline">Log In</a> first to enable wallet connection.
                                    </p>
                                )}
                            </div>
                        )}

                        {activeSection === 'manual' && (
                            <div className="flex flex-col items-center mt-8">
                                <h2 className="text-2xl font-bold text-binance-text-light mb-4">Manual Wallet Connection</h2>
                                <p className="text-sm text-binance-red mb-4 text-center p-2 bg-red-900/20 rounded-lg border border-red-700">
                                    Note: Manual connection is primarily for **viewing balances** and does not enable transactions or signing messages.
                                    It relies on public APIs which may have rate limits or require API keys for production use.
                                </p>

                                {/* Conditionally render manual connection form or connected info */}
                                {!userStatus.connectedWalletInfo || userStatus.connectedWalletInfo.type !== 'manual' ? (
                                    <>
                                        <div className="w-full max-w-sm mb-4">
                                            <label htmlFor="network-select" className="block text-left text-binance-text-muted text-sm font-bold mb-2">Select Network:</label>
                                            <select
                                                id="network-select"
                                                className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-binance-text-light leading-tight
                                                           focus:outline-none focus:shadow-outline focus:ring-2 focus:ring-binance-accent-yellow bg-binance-bg-primary border-binance-border"
                                                value={selectedNetworkId}
                                                onChange={(e) => {
                                                    setSelectedNetworkId(e.target.value);
                                                    setShowManualConnectInfo(false);
                                                    setManualAddressInput(''); // Clear address input on network change
                                                }}
                                                disabled={!userStatus.isLoggedIn}
                                            >
                                                <option value="">Select a Network</option>
                                                {networks.map(network => (
                                                    <option key={network.id} value={network.id}>{network.name}</option>
                                                ))}
                                            </select>
                                        </div>

                                        {selectedNetworkId && (
                                            <div className="w-full max-w-sm mb-4">
                                                <label htmlFor="wallet-address-input" className="block text-left text-binance-text-muted text-sm font-bold mb-2">Enter Address:</label>
                                                <input
                                                    type="text"
                                                    id="wallet-address-input"
                                                    placeholder="e.g., 0x..."
                                                    className="w-full px-4 py-3 rounded-lg bg-binance-surface-elevated text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                                    value={manualAddressInput}
                                                    onChange={(e) => setManualAddressInput(e.target.value)}
                                                    disabled={!userStatus.isLoggedIn}
                                                />
                                            </div>
                                        )}

                                        {selectedNetworkId && (
                                            <button
                                                onClick={handleFetchBalance}
                                                className="bg-binance-accent-yellow hover:opacity-90 text-binance-bg-primary font-bold py-3 px-6 rounded-xl shadow-binance-md
                                                           transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-binance-accent-yellow
                                                           w-full max-w-sm flex items-center justify-center gap-2"
                                                disabled={isManualLoading || !userStatus.isLoggedIn}
                                            >
                                                {isManualLoading ? (
                                                    <span className="flex items-center justify-center">
                                                        <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-binance-bg-primary mr-3"></div>
                                                        Connect
                                                    </span>
                                                ) : (
                                                    <>
                                                        <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                            <path fillRule="evenodd" d="M3 8a2 2 0 012-2h10a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8zm5-3a1 1 0 00-1 1v2a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd"></path>
                                                        </svg>
                                                        Connect
                                                    </>
                                                )}
                                            </button>
                                        )}
                                        {!userStatus.isLoggedIn && (
                                            <p className="text-sm text-binance-text-muted mt-4">
                                                Please <a href="#" onClick={(e) => { e.preventDefault(); navigate('loginPage'); }} className="text-binance-accent-yellow hover:underline">Log In</a> first to enable manual connection.
                                            </p>
                                        )}
                                    </>
                                ) : (
                                    <div className="mt-8 p-4 bg-binance-surface-elevated border border-binance-border rounded-xl w-full">
                                        <h2 className="text-xl font-semibold text-binance-text-light mb-2">Wallet Connected!</h2>
                                        <p className="text-binance-text-muted break-all">
                                            <span className="font-medium">Network:</span> <span className="text-binance-accent-yellow">{manualNetworkDisplay}</span>
                                        </p>
                                        <p className="text-binance-text-muted break-all mb-2">
                                            <span className="font-medium">Address:</span> <span className="text-binance-accent-yellow font-mono">{manualAddressDisplay}</span>
                                        </p>
                                        <p className="text-binance-text-muted break-all">
                                            <span className="font-medium">Balance:</span> <span className="text-binance-accent-yellow font-mono">{manualBalanceDisplay}</span>
                                        </p>
                                        <button
                                            onClick={handleDisconnectWallet}
                                            className="mt-4 w-full px-4 py-2 bg-binance-red text-white font-semibold rounded-lg hover:bg-red-600 transition-colors duration-200"
                                        >
                                            Disconnect Wallet
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Wallet Dashboard Page: Shows wallet balances, assets, and transaction history
        const WalletDashboard = ({ navigate }) => {
            const { userStatus } = useContext(UserContext);
            const totalBalance = userStatus.connectedWalletInfo?.balance || '0.00 USD';
            const connectedAddress = userStatus.connectedWalletInfo?.address;

            const [activeTab, setActiveTab] = useState('overview'); // Controls which wallet tab is active
            const [marketData, setMarketData] = useState([]); // For real-time asset prices
            const [loadingAssets, setLoadingAssets] = useState(true);

            // Simulated user assets for the dashboard (in a real app, this would be from user's actual wallet)
            const simulatedUserAssets = [
                { id: 'bitcoin', ticker: 'BTC', name: 'Bitcoin', total: '0.005', available: '0.005', inOrder: '0', icon: 'https://assets.coingecko.com/coins/images/1/large/bitcoin.png' },
                { id: 'ethereum', ticker: 'ETH', name: 'Ethereum', total: '0.12', available: '0.12', inOrder: '0', icon: 'https://assets.coingecko.com/coins/images/279/large/ethereum.png' },
                { id: 'binancecoin', ticker: 'BNB', name: 'BNB', total: '0.5', available: '0.5', inOrder: '0', icon: 'https://assets.coingecko.com/coins/images/825/large/binance-coin-logo.png' },
                { id: 'tether', ticker: 'USDT', name: 'TetherUS', total: '100.00', available: '100.00', inOrder: '0', icon: 'https://assets.coingecko.com/coins/images/325/large/Tether.png' },
                { id: 'solana', ticker: 'SOL', name: 'Solana', total: '0.8', available: '0.8', inOrder: '0', icon: 'https://assets.coingecko.com/coins/images/4128/large/solana.png' },
            ];

            // Effect to fetch live prices for the simulated assets
            useEffect(() => {
                const fetchAssetPrices = async () => {
                    setLoadingAssets(true);
                    try {
                        const coinIds = simulatedUserAssets.map(asset => asset.id).join(',');
                        const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coinIds}&vs_currencies=usd&include_24hr_change=true`);
                        const data = await response.json();

                        const updatedAssets = simulatedUserAssets.map(asset => {
                            const priceData = data[asset.id] || {};
                            const currentPrice = priceData.usd || 0;
                            const priceChange = priceData.usd_24hr_change || 0;
                            const usdValue = (parseFloat(asset.total) * currentPrice).toFixed(2);
                            return {
                                ...asset,
                                currentPrice: currentPrice,
                                usdValue: usdValue,
                                priceChange24h: priceChange.toFixed(2),
                                isPositive: priceChange >= 0
                            };
                        });
                        setMarketData(updatedAssets);
                    } catch (error) {
                        console.error("Error fetching asset prices:", error);
                        showModal("Failed to fetch live asset prices. Displaying simulated values.");
                        // Fallback to initial simulated assets with random values if API fails
                        setMarketData(simulatedUserAssets.map(asset => ({
                            ...asset,
                            currentPrice: 'N/A',
                            usdValue: (parseFloat(asset.total) * (Math.random() * 1000 + 100)).toFixed(2),
                            priceChange24h: (Math.random() * 4 - 2).toFixed(2),
                            isPositive: (Math.random() * 4 - 2) >= 0
                        })));
                    } finally {
                        setLoadingAssets(false);
                    }
                };

                fetchAssetPrices(); // Initial fetch
                const interval = setInterval(fetchAssetPrices, 60 * 1000); // Refresh every minute
                return () => clearInterval(interval); // Cleanup on component unmount
            }, []); // Empty dependency array means this runs once on mount

            // Component for individual transaction history items
            const TransactionHistoryItem = ({ type, asset, amount, date, status }) => (
                <li className="flex justify-between items-center py-3 border-b border-binance-border last:border-b-0">
                    <div>
                        <div className="font-semibold text-binance-text-light">{type} {asset}</div>
                        <div className="text-sm text-binance-text-muted">{date}</div>
                    </div>
                    <div className="text-right">
                        <div className={`font-medium ${type === 'Deposit' ? 'text-binance-green' : 'text-binance-red'}`}>
                            {type === 'Deposit' ? '+' : '-'} {amount} {asset}
                        </div>
                        <div className="text-sm text-binance-text-muted">{status}</div>
                    </div>
                </li>
            );

            // Handlers for deposit, withdraw, and trade actions (meaningful simulations)
            const handleDeposit = () => showModal('Simulating deposit flow: Please scan QR code or enter address for deposit.');
            const handleWithdraw = () => showModal('Simulating withdrawal flow: Enter amount and destination address to withdraw.');
            const handleTrade = () => showModal('Simulating trade execution: Confirm order details to complete trade.');

            return (
                <div className="min-h-screen bg-binance-bg-primary pt-16 transition-colors duration-300">
                    <div className="container mx-auto px-4 py-8">
                        {/* Wallet Overview Header Section */}
                        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg mb-8 border border-binance-border">
                            <h1 className="text-3xl font-bold text-binance-text-light mb-2">Wallet Overview</h1>
                            <p className="text-binance-text-muted mb-4">
                                {userStatus.isLoggedIn && connectedAddress ? `Connected Wallet: ${connectedAddress.length > 20 ? `${connectedAddress.substring(0, 10)}...${connectedAddress.substring(connectedAddress.length - 8)}` : connectedAddress}` : 'No wallet connected'}
                            </p>
                            <div className="flex flex-col sm:flex-row items-end justify-between mb-4">
                                <div>
                                    <p className="text-binance-text-muted text-lg">Estimated Balance</p>
                                    <p className="text-4xl font-bold text-binance-text-light">{totalBalance}</p>
                                </div>
                                <div className="flex space-x-3 mt-4 sm:mt-0">
                                    <button onClick={handleDeposit} className="px-5 py-2 w-28 bg-binance-green text-white font-semibold rounded-lg hover:bg-green-600 transition-colors duration-200">Deposit</button>
                                    <button onClick={handleWithdraw} className="px-5 py-2 w-28 bg-binance-red text-white font-semibold rounded-lg hover:bg-red-600 transition-colors duration-200">Withdraw</button>
                                    <button onClick={handleTrade} className="px-5 py-2 w-28 bg-binance-blue text-white font-semibold rounded-lg hover:bg-blue-600 transition-colors duration-200">Trade</button>
                                </div>
                            </div>
                        </div>

                        {/* Navigation Tabs for different wallet views */}
                        <div className="flex justify-center border-b border-binance-border mb-8 overflow-x-auto">
                            {['overview', 'spot', 'futures', 'earn', 'nft', 'transactionHistory'].map(tab => (
                                <button
                                    key={tab}
                                    onClick={() => setActiveTab(tab)}
                                    className={`px-4 py-3 text-base font-medium whitespace-nowrap ${activeTab === tab ? 'text-binance-accent-yellow border-b-2 border-binance-accent-yellow' : 'text-binance-text-muted hover:text-binance-text-light'}`}
                                >
                                    {tab === 'transactionHistory' ? 'History' : tab.charAt(0).toUpperCase() + tab.slice(1)}
                                </button>
                            ))}
                        </div>

                        {/* Content based on Active Tab */}
                        {activeTab === 'overview' && (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                {/* Spot Wallet Balance Overview */}
                                <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg border border-binance-border">
                                    <h2 className="text-2xl font-bold text-binance-text-light mb-4">Spot Wallet Balance</h2>
                                    {loadingAssets ? (
                                        <div className="text-center py-8 text-binance-text-muted">Loading assets...</div>
                                    ) : (
                                        <ul className="space-y-3">
                                            {marketData.map(asset => (
                                                <li key={asset.ticker} className="flex justify-between items-center py-2 border-b border-binance-border last:border-b-0">
                                                    <div className="flex items-center space-x-2">
                                                        {asset.icon && <img src={asset.icon} alt={`${asset.name} icon`} className="w-6 h-6" />}
                                                        <span className="font-medium text-binance-text-light">{asset.ticker}</span>
                                                    </div>
                                                    <div className="text-right">
                                                        <span className="text-binance-text-light">{asset.total} {asset.ticker}</span>
                                                        <span className="text-binance-text-muted block text-sm">${asset.usdValue}</span>
                                                        <span className={`text-sm ${asset.isPositive ? 'text-binance-green' : 'text-binance-red'}`}>{asset.priceChange24h}%</span>
                                                    </div>
                                                </li>
                                            ))}
                                        </ul>
                                    )}
                                    <div className="text-right mt-4">
                                        <button onClick={() => setActiveTab('spot')} className="text-binance-accent-yellow hover:underline font-medium">View Spot Wallet</button>
                                    </div>
                                </div>

                                {/* Recent Transactions Overview */}
                                <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg border border-binance-border">
                                    <h2 className="text-2xl font-bold text-binance-text-light mb-4">Recent Transactions</h2>
                                    <ul className="space-y-3">
                                        <TransactionHistoryItem type="Deposit" asset="USDT" amount="100.00" date="2025-07-30" status="Completed" />
                                        <TransactionHistoryItem type="Trade" asset="BTC" amount="0.0001" date="2025-07-29" status="Filled" />
                                        <TransactionHistoryItem type="Withdraw" asset="ETH" amount="0.01" date="2025-07-28" status="Completed" />
                                        <TransactionHistoryItem type="Deposit" asset="BNB" amount="0.1" date="2025-07-27" status="Completed" />
                                    </ul>
                                    <div className="text-right mt-4">
                                        <button onClick={() => setActiveTab('transactionHistory')} className="text-binance-accent-yellow hover:underline font-medium">View All History</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'spot' && (
                            <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg border border-binance-border">
                                <h2 className="text-2xl font-bold text-binance-text-light mb-4">Spot Wallet</h2>
                                <div className="overflow-x-auto">
                                    <table className="min-w-full divide-y divide-binance-border">
                                        <thead className="bg-binance-surface-elevated">
                                            <tr>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-binance-text-muted uppercase tracking-wider">Asset</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-binance-text-muted uppercase tracking-wider">Total</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-binance-text-muted uppercase tracking-wider">Available</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-binance-text-muted uppercase tracking-wider">In Order</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-binance-text-muted uppercase tracking-wider">USD Value</th>
                                                <th scope="col" className="px-6 py-3 text-right text-xs font-medium text-binance-text-muted uppercase tracking-wider">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="bg-binance-bg-secondary divide-y divide-binance-border">
                                            {loadingAssets ? (
                                                <tr><td colSpan="6" className="text-center py-4 text-binance-text-muted">Loading assets...</td></tr>
                                            ) : (
                                                marketData.map(asset => (
                                                    <tr key={asset.ticker}>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-binance-text-light">
                                                            <div className="flex items-center space-x-2">
                                                                {asset.icon && <img src={asset.icon} alt={`${asset.name} icon`} className="w-6 h-6" />}
                                                                <span>{asset.ticker}</span>
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-binance-text-light">{asset.total}</td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-binance-text-light">{asset.available}</td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-binance-text-light">{asset.inOrder}</td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-binance-text-light">${asset.usdValue}</td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                                                            <button onClick={handleDeposit} className="text-binance-green hover:text-green-400">Deposit</button>
                                                            <button onClick={handleWithdraw} className="text-binance-red hover:text-red-400">Withdraw</button>
                                                            <button onClick={handleTrade} className="text-binance-blue hover:text-blue-400">Trade</button>
                                                        </td>
                                                    </tr>
                                                ))
                                            )}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {activeTab === 'futures' && (
                            <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg text-center border border-binance-border">
                                <h2 className="text-2xl font-bold text-binance-text-light mb-4">Futures Wallet</h2>
                                <p className="text-binance-text-muted mb-4">
                                    Engage in crypto futures trading. This section provides a simulated overview.
                                </p>
                                <button onClick={() => showModal('Simulating futures trading interface.')} className="px-6 py-3 bg-binance-blue text-white font-semibold rounded-lg hover:bg-blue-600 transition-colors duration-200">Go to Futures</button>
                            </div>
                        )}

                        {activeTab === 'earn' && (
                            <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg text-center border border-binance-border">
                                <h2 className="text-2xl font-bold text-binance-text-light mb-4">Earn</h2>
                                <p className="text-binance-text-muted mb-4">
                                    Put your crypto to work and earn passive income. This section provides a simulated overview.
                                </p>
                                <button onClick={() => showModal('Exploring various Earn products and staking options.')} className="px-6 py-3 bg-purple-500 text-white font-semibold rounded-lg hover:bg-purple-600 transition-colors duration-200">Explore Earn</button>
                            </div>
                        )}

                        {activeTab === 'nft' && (
                            <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg text-center border border-binance-border">
                                <h2 className="text-2xl font-bold text-binance-text-light mb-4">NFT Wallet</h2>
                                <p className="text-binance-text-muted mb-4">
                                    Manage your unique digital collectibles. This section provides a simulated overview.
                                </p>
                                <button onClick={() => showModal('Browsing the NFT marketplace.')} className="px-6 py-3 bg-pink-500 text-white font-semibold rounded-lg hover:bg-pink-600 transition-colors duration-200">View NFTs</button>
                            </div>
                        )}

                        {activeTab === 'transactionHistory' && (
                            <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg border border-binance-border">
                                <h2 className="text-2xl font-bold text-binance-text-light mb-4">Full Transaction History</h2>
                                <p className="text-binance-text-muted mb-4">
                                    Detailed history of your deposits, withdrawals, and trades. (Simulated Data)
                                </p>
                                <ul className="space-y-3">
                                    <TransactionHistoryItem type="Deposit" asset="USDT" amount="100.00" date="2025-07-30 14:30" status="Completed" />
                                    <TransactionHistoryItem type="Trade" asset="BTC" amount="0.0001" date="2025-07-29 10:15" status="Filled" />
                                    <TransactionHistoryItem type="Withdraw" asset="ETH" amount="0.01" date="2025-07-28 18:00" status="Completed" />
                                    <TransactionHistoryItem type="Deposit" asset="BNB" amount="0.1" date="2025-07-27 09:00" status="Completed" />
                                    <TransactionHistoryItem type="Trade" asset="SOL" amount="0.5" date="2025-07-26 11:45" status="Filled" />
                                    <TransactionHistoryItem type="Deposit" asset="ETH" amount="0.05" date="2025-07-25 16:20" status="Completed" />
                                    <TransactionHistoryItem type="Withdraw" asset="USDT" amount="20.00" date="2025-07-24 13:00" status="Processing" />
                                    <TransactionHistoryItem type="Trade" asset="BNB" amount="0.02" date="2025-07-23 09:30" status="Canceled" />
                                </ul>
                                <div className="text-center mt-6 text-binance-text-muted">
                                    <p>End of simulated history.</p>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Settings Page: User preferences and logout option
        const SettingsPage = ({ navigate, setUserStatus }) => {
            const handleLogout = () => {
                showModal('Logging out...');
                setTimeout(() => {
                    setUserStatus({ isLoggedIn: false, connectedWalletInfo: null }); // Clear all user status on logout
                    navigate('landingPage'); // Navigate to landing page after logout
                    hideModal();
                }, 2000); // Simulate logout delay
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 transition-colors duration-300 p-4">
                    <div className="bg-binance-bg-secondary p-8 rounded-xl shadow-binance-lg w-11/12 max-w-md border border-binance-border">
                        <h2 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Settings</h2>
                        <div className="flex flex-col space-y-4">
                            <button
                                onClick={() => showModal('Accessing profile settings.')}
                                className="w-full px-6 py-3 border border-binance-border text-binance-text-light font-semibold rounded-lg hover:bg-binance-surface-elevated transition-colors duration-200"
                            >
                                Profile Settings
                            </button>
                            <button
                                onClick={() => showModal('Accessing security settings.')}
                                className="w-full px-6 py-3 border border-binance-border text-binance-text-light font-semibold rounded-lg hover:bg-binance-surface-elevated transition-colors duration-200"
                            >
                                Security Settings
                            </button>
                            <button
                                onClick={handleLogout}
                                className="w-full px-6 py-3 bg-binance-red text-white font-semibold rounded-lg shadow-binance-md hover:bg-red-600 transition-colors duration-200"
                            >
                                Log Out
                            </button>
                        </div>
                    </div>
                </div>
            );
        };


        // --- Main App Component ---
        // Manages the overall application state, routing, and theme
        const App = () => {
            // State for dark mode, initialized to 'dark' as per instruction and persisted in local storage
            const [isDarkMode, setIsDarkMode] = useState(() => {
                // Prioritize 'dark' mode as instructed, but allow user override from localStorage
                if (localStorage.getItem('theme')) {
                    return localStorage.getItem('theme') === 'dark';
                }
                return true; // Default to dark mode as requested
            });

            // State for user authentication and wallet connection, persisted in session storage
            const [userStatus, setUserStatus] = useState(() => {
                const savedUserStatus = sessionStorage.getItem('userStatus');
                return savedUserStatus ? JSON.parse(savedUserStatus) : { isLoggedIn: false, connectedWalletInfo: null };
            });

            // Determine if both login and wallet connection are complete for main app access
            const isLoginAndWalletConnected = userStatus.isLoggedIn && !!userStatus.connectedWalletInfo;

            // Determine initial page based on login and wallet connection status
            const initialPage = isLoginAndWalletConnected ? 'homePage' : 'landingPage';
            const [history, setHistory] = useState([initialPage]); // Start the app on the appropriate page
            const currentPage = history[history.length - 1]; // Current page is the last in history

            // Effect to save user status to session storage whenever it changes
            useEffect(() => {
                sessionStorage.setItem('userStatus', JSON.stringify(userStatus));
            }, [userStatus]);

            // Callback to toggle dark mode
            const toggleDarkMode = useCallback(() => {
                setIsDarkMode(prevMode => {
                    const newMode = !prevMode;
                    localStorage.setItem('theme', newMode ? 'dark' : 'light'); // Save theme preference
                    return newMode;
                });
            }, []);

            // Effect to apply dark/light mode class to the <html> element
            useEffect(() => {
                if (isDarkMode) {
                    document.documentElement.classList.add('dark');
                    document.documentElement.classList.remove('light');
                } else {
                    document.documentElement.classList.remove('dark');
                    document.documentElement.classList.add('light');
                }
            }, [isDarkMode]);

            // Function to navigate to a new page (adds to history), with access control
            const navigate = (pageName) => {
                setHistory(prevHistory => {
                    // Check access control for main app pages
                    if ((pageName === 'homePage' || pageName === 'walletDashboard') && !isLoginAndWalletConnected) {
                        showModal('Please log in and connect your wallet to access this feature.');
                        return ['landingPage']; // Redirect to landing page if access denied
                    }

                    // If navigating to an existing page in history, "trim" the history stack
                    const existingIndex = prevHistory.indexOf(pageName);
                    if (existingIndex !== -1) {
                        return prevHistory.slice(0, existingIndex + 1);
                    }
                    return [...prevHistory, pageName]; // Add new page to history
                });
            };

            // Function to go back in history
            const goBack = () => {
                setHistory(prevHistory => {
                    if (prevHistory.length > 1) {
                        return prevHistory.slice(0, prevHistory.length - 1);
                    }
                    return prevHistory; // Stay on current page if no history to go back
                });
            };

            // Determine if the back button should be shown
            // Show back button if there's more than one page in history AND the current page is not the initial landing/home page
            // This prevents the back button from showing immediately on load if it's the first page
            const showBackButton = history.length > 1 && history[0] !== currentPage;

            // Render the appropriate page component based on the current page in history
            let PageComponent;
            switch (currentPage) {
                case 'landingPage':
                    PageComponent = <LandingPage navigate={navigate} />;
                    break;
                case 'homePage':
                    PageComponent = <HomePage navigate={navigate} />;
                    break;
                case 'loginPage':
                    PageComponent = <LoginPage navigate={navigate} setUserStatus={setUserStatus} />;
                    break;
                case 'walletConnectPage':
                    PageComponent = <WalletConnectPage navigate={navigate} setUserStatus={setUserStatus} />;
                    break;
                case 'walletDashboard':
                    PageComponent = <WalletDashboard navigate={navigate} />;
                    break;
                case 'settingsPage':
                    PageComponent = <SettingsPage navigate={navigate} setUserStatus={setUserStatus} />;
                    break;
                default:
                    // Fallback to home page, applying access control if needed
                    PageComponent = isLoginAndWalletConnected ? <HomePage navigate={navigate} /> : <LandingPage navigate={navigate} />;
                    break;
            }

            return (
                <UserContext.Provider value={{ userStatus, setUserStatus }}>
                    <div className="min-h-screen bg-binance-bg-primary text-binance-text-light transition-colors duration-300">
                        {/* Header and Footer are consistent across all pages */}
                        <Header toggleDarkMode={toggleDarkMode} isDarkMode={isDarkMode} navigate={navigate} goBack={goBack} showBackButton={showBackButton} />
                        <main className="min-h-[calc(100vh-160px)]"> {/* Adjusted min-height to account for header/footer */}
                            {PageComponent} {/* Renders the currently active page component */}
                        </main>
                        <Footer />
                    </div>
                </UserContext.Provider>
            );
        };

        // Render the main React App component to the 'root' div when the window loads
        window.onload = function () {
            ReactDOM.createRoot(document.getElementById('root')).render(<App />);
        };
    </script>
</body>
</html>

