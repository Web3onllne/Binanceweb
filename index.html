<<!DOCTYPE html>
<html lang="en" class="dark"> <!-- Force dark mode initially as per instruction -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binance Web3 Wallet</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tailwind CSS configuration must come AFTER the Tailwind CDN script -->
    <script>
        tailwind.config = {
            darkMode: 'class', // Enables dark mode based on the 'dark' class on the html element
            theme: {
                extend: {
                    colors: {
                        // Custom Binance-like theme colors, precisely mapped from provided template
                        'binance-bg-primary': '#1E2329', // Very dark primary background (from template)
                        'binance-bg-secondary': '#2b3139', // Slightly lighter card/section background (from template)
                        'binance-accent-yellow': '#FCD535', // Binance's iconic bright yellow (from template)
                        'binance-text-light': '#FFFFFF', // Light text for dark backgrounds (from template: white)
                        'binance-text-muted': '#A8B0BC', // Muted text for secondary info (gray-400 from template)
                        'binance-surface-elevated': '#1A1D22', // Deeper dark for layered elements/hover states (from template's chart background)
                        'binance-border': '#363a45', // Border color in dark mode (from template's footer border)

                        // Specific action colors matching Binance
                        'binance-green': '#16C784', // Common green for gains/buy
                        'binance-red': '#EA3943',   // Common red for losses/sell
                        'binance-blue': '#1874D0',  // General action/info blue
                        'binance-purple-dark': '#4b0082', // A darker purple for gradients
                        'binance-blue-dark': '#0a0a38', // A darker blue for gradients
                    },
                    fontFamily: {
                        // Inter font for a clean, modern look, as requested by default
                        sans: ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        // Custom shadow to match Binance's subtle UI elevations
                        'binance-sm': '0 1px 2px 0 rgba(0, 0, 0, 0.05)',
                        'binance-md': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                        'binance-lg': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                    }
                }
            }
        }
    </script>
    <!-- Link to Inter font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- React and ReactDOM CDNs -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel Standalone for in-browser JSX compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- WalletConnect Web3-Provider & Web3.js for blockchain interactions -->
    <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.0/dist/web3.min.js"></script>
    <!-- QRCode.js for generating QR codes -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode.js@1.0.0/qrcode.min.js"></script>

    <!-- PWA Manifest Link -->
</head>
<body className="font-sans antialiased text-binance-text-light bg-binance-bg-primary transition-colors duration-300">

    <!-- Root div where the React app will be mounted -->
    <div id="root"></div>

    <!-- Custom Modal for displaying messages to the user (reused throughout the app) -->
    <div id="message-modal" className="hidden fixed inset-0 z-[1000] bg-black bg-opacity-40 flex items-center justify-center">
        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-lg w-11/12 max-w-sm text-center relative">
            <span className="close-button absolute top-3 right-5 text-gray-500 hover:text-gray-300 text-3xl cursor-pointer" id="close-modal-button">&times;</span>
            <p id="modal-message" className="text-lg text-binance-text-light mt-4"></p>
        </div>
    </div>

    <!-- Main application script, using Babel for JSX processing -->
    <script type="text/babel">
        // Destructuring React hooks and functions for easier use
        const { useState, useEffect, useCallback, createContext, useContext, useRef } = React;

        // --- Global Message Modal Functions ---
        // These functions control the visibility and content of the centralized modal
        const messageModal = document.getElementById('message-modal');
        const modalMessage = document.getElementById('modal-message');
        const closeModalButton = document.getElementById('close-modal-button');

        const showModal = (message) => {
            modalMessage.textContent = message;
            messageModal.classList.remove('hidden');
        };

        const hideModal = () => {
            modalMessage.textContent = ''; // Clear message when hiding
            messageModal.classList.add('hidden');
        };

        closeModalButton.onclick = hideModal;
        window.onclick = (event) => {
            if (event.target === messageModal) {
                hideModal();
            }
        };

        // --- PWA Setup ---
        // Handles the installation prompt and app installation events for PWA
        let deferredPrompt; // Stores the 'beforeinstallprompt' event

        function setupPWA() {
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault(); // Prevents the default browser prompt
                deferredPrompt = e; // Stores the event for later use
                console.log('beforeinstallprompt fired, deferredPrompt stored.');
            });

            window.addEventListener('appinstalled', () => {
                console.log('PWA was installed!');
                showModal('Binance Web3 Wallet PWA installed successfully!');
            });

            window.addEventListener('load', () => {
                // Dynamically creates and links the Web App Manifest
                const manifestContent = {
                    name: 'Binance Web3 Wallet',
                    short_name: 'BinanceWallet',
                    description: 'Your secure crypto wallet powered by Binance',
                    theme_color: '#1E2329', // Theme color for the PWA (updated)
                    background_color: '#1E2329', // Background color for the PWA splash screen (updated)
                    display: 'standalone', // Makes the app run in standalone mode
                    scope: '/', // Scope of the PWA
                    start_url: '/', // Starting URL when the PWA is launched
                    icons: [
                        // High-resolution icons for various devices
                        { src: 'https://upload.wikimedia.org/wikipedia/commons/4/4c/Binance_Logo.svg', sizes: '192x192', type: 'image/svg+xml' },
                        { src: 'https://upload.wikimedia.org/wikipedia/commons/4/4c/Binance_Logo.svg', sizes: '512x512', type: 'image/svg+xml', purpose: 'maskable' }
                    ],
                    orientation: 'portrait' // Preferred orientation
                };

                const manifestBlob = new Blob([JSON.stringify(manifestContent)], { type: 'application/json' });
                const manifestUrl = URL.createObjectURL(manifestBlob);
                const link = document.createElement('link');
                link.rel = 'manifest';
                link.href = manifestUrl;
                document.head.appendChild(link);
                console.log('Manifest linked successfully.');
                console.warn("Service Worker registration from 'blob:' URLs is often restricted by browsers in single-file setups. Full PWA offline caching may not work.");
            });
        }
        setupPWA(); // Initialize PWA setup

        // --- User Context for Persistent Login State ---
        // Provides user authentication and wallet connection status throughout the app
        const UserContext = createContext(null);

        // --- Shared Components ---
        // Generic Modal Component
        const Modal = ({ isOpen, onClose, children, title }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-[1000] bg-black bg-opacity-70 flex items-center justify-center p-4">
                    <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-lg w-full max-w-lg text-center relative border border-binance-border">
                        <button
                            onClick={onClose}
                            className="absolute top-3 right-5 text-binance-text-muted hover:text-binance-text-light text-3xl font-bold transition-colors duration-200"
                            aria-label="Close modal"
                        >
                            &times;
                        </button>
                        {title && <h2 className="text-2xl font-bold text-binance-text-light mb-4">{title}</h2>}
                        {children}
                    </div>
                </div>
            );
        };

        // Component to toggle between light and dark mode
        const DarkModeToggle = ({ isDarkMode, toggleDarkMode }) => (
            <button
                onClick={toggleDarkMode}
                className="p-2 rounded-full bg-binance-bg-secondary text-binance-text-light hover:bg-zinc-700 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                aria-label="Toggle dark mode"
            >
                {isDarkMode ? (
                    <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 00-.707-.293h-1.414a1 1 0 100 2h1.414a1 1 0 00.707-.293zm-9.192 9.192a1 1 0 00-.707.293l-.707.707a1 1 0 001.414 1.414l.707-.707a1 1 0 00-.293-1.414zM4 10a1 1 0 01-1-1V8a1 1 0 112 0v1a1 1 0 01-1 1zm-4.95-3.536a1 1 0 00.293.707L1.464 8.536a1 1 0 101.414-1.414L2.05 6.464a1 1 0 00-.707-.293zM16 10a1 1 0 01-1-1V8a1 1 0 112 0v1a1 1 0 01-1 1zm4.95-3.536a1 1 0 00-.293.707l-.707.707a1 1 0 00-1.414-1.414l.707-.707a1 1 0 00.707-.293z"></path></svg>
                ) : (
                    <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.04a.75.75 0 010 1.06l-.707.707a.75.75 0 01-1.06 0L14 13.04a6 6 0 11-8.485-8.485.75.75 0 011.06 1.06A4.5 4.5 0 1015.939 12a.75.75 0 011.354.54z"></path></svg>
                )}
            </button>
        );

        // Header component for navigation and branding
        const Header = ({ toggleDarkMode, isDarkMode, navigate, goBack, showBackButton }) => {
            const { userStatus, setUserStatus } = useContext(UserContext);

            const handleDisconnectWallet = () => {
                showModal('Disconnecting wallet...');
                setTimeout(() => {
                    setUserStatus({ ...userStatus, connectedWalletInfo: null }); // Keep login status, but clear wallet
                    showModal('Wallet disconnected!');
                    hideModal();
                }, 1500);
            };

            return (
                <header className="bg-binance-bg-secondary shadow-sm dark:shadow-md fixed top-0 left-0 right-0 z-50 transition-colors duration-300">
                    <nav className="container mx-auto px-4 py-3 flex justify-between items-center">
                        {/* Back Button, visible when not on initial landing or home page and history exists */}
                        {showBackButton && (
                            <button
                                onClick={goBack}
                                className="mr-3 p-2 rounded-full bg-binance-surface-elevated text-binance-text-light hover:bg-zinc-700 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                aria-label="Go back"
                            >
                                <svg className="w-5 h-5 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 10">
                                    <path stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 5H1m0 0 4 4m-4-4 4-4"/>
                                </svg>
                            </button>
                        )}

                        {/* Binance Logo and App Title */}
                        <div className="flex items-center space-x-2 cursor-pointer" onClick={() => navigate('dashboardPage')}>
                            {/* Updated src to the new image */}
                            <img src="icon (1).png" alt="Binance Web3 Wallet Icon" className="w-10 h-10" />
                            <span className="text-xl font-bold text-binance-text-light">Binance Web3 Wallet</span>
                        </div>

                        {/* Main Navigation Links (hidden on small screens) */}
                        <div className="hidden md:flex items-center space-x-6">
                            <a href="#" onClick={() => navigate('dashboardPage')} className="text-binance-text-light hover:text-binance-accent-yellow font-medium transition-colors duration-200">Wallet</a>
                            <a href="#" onClick={() => showModal('Markets overview page.')} className="text-binance-text-light hover:text-binance-accent-yellow font-medium transition-colors duration-200">Markets</a>
                            <a href="#" onClick={() => navigate('tradePage')} className="text-binance-text-light hover:text-binance-accent-yellow font-medium transition-colors duration-200">Trade</a>
                            <a href="#" onClick={() => navigate('earnPage')} className="text-binance-text-light hover:text-binance-accent-yellow font-medium transition-colors duration-200">Earn</a>
                            {/* Always show "Wallet" link for logged-in users or if wallet is connected for quick access */}
                            {(userStatus.isLoggedIn || userStatus.connectedWalletInfo) && (
                                <a href="#" onClick={() => navigate('dashboardPage')} className="text-binance-text-light hover:text-binance-accent-yellow font-medium transition-colors duration-200">Dashboard</a>
                            )}
                        </div>

                        {/* Action Buttons (Login, Connect Wallet, Settings) and Dark Mode Toggle */}
                        <div className="flex items-center space-x-3 sm:space-x-4">
                            {!userStatus.isLoggedIn && (
                                <button
                                    onClick={() => navigate('loginPage')}
                                    className="hidden sm:inline-block px-4 py-2 text-sm font-semibold text-binance-text-light rounded-lg hover:bg-binance-surface-elevated transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                >
                                    Log In
                                </button>
                            )}

                            {userStatus.connectedWalletInfo ? (
                                <div className="relative group">
                                    <button
                                        onClick={() => navigate('dashboardPage')}
                                        className="px-4 py-2 text-sm font-semibold bg-binance-green text-white rounded-lg hover:bg-green-600 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-binance-green"
                                    >
                                        Wallet Connected
                                    </button>
                                    <div className="absolute right-0 mt-2 w-48 bg-binance-bg-secondary rounded-lg shadow-xl py-1 hidden group-hover:block transition-all duration-300 origin-top-right border border-binance-border">
                                        <div className="px-4 py-2 text-sm text-binance-text-muted break-all">
                                            {/* Display truncated address or username */}
                                            {userStatus.connectedWalletInfo.address ?
                                                `${userStatus.connectedWalletInfo.address.substring(0, 6)}...${userStatus.connectedWalletInfo.address.substring(userStatus.connectedWalletInfo.address.length - 4)}`
                                                : userStatus.connectedWalletInfo.username}
                                        </div>
                                        <button
                                            onClick={handleDisconnectWallet}
                                            className="block w-full text-left px-4 py-2 text-sm text-binance-red hover:bg-binance-surface-elevated transition-colors duration-200"
                                        >
                                            Disconnect
                                        </button>
                                    </div>
                                </div>
                            ) : (
                                <button
                                    onClick={() => navigate('walletConnectPage')}
                                    className="px-4 py-2 text-sm font-semibold bg-binance-accent-yellow text-binance-bg-primary rounded-lg hover:opacity-90 transition-opacity duration-200 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                >
                                    Connect Wallet
                                </button>
                            )}

                            {userStatus.isLoggedIn && (
                                <button
                                    onClick={() => navigate('settingsPage')}
                                    className="px-4 py-2 text-sm font-semibold text-binance-text-light rounded-lg hover:bg-binance-surface-elevated transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                >
                                    Settings
                                </button>
                            )}
                            <DarkModeToggle isDarkMode={isDarkMode} toggleDarkMode={toggleDarkMode} />
                        </div>
                    </nav>
                </header>
            );
        };

        // Footer component with site navigation and copyright
        // Adjusted to match the provided template's footer
        const Footer = ({ navigate }) => (
            <footer className="flex justify-around items-center p-4 border-t border-binance-border bg-binance-bg-primary fixed bottom-0 w-full z-10">
                <button onClick={() => navigate('dashboardPage')} className="flex flex-col items-center text-binance-accent-yellow">
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2l-10 9h2v11h6v-7h4v7h6v-11h2l-10-9z" />
                    </svg>
                    <span className="text-xs mt-1">Wallet</span>
                </button>
                <button onClick={() => showModal('Markets overview page functionality here.')} className="flex flex-col items-center text-binance-text-muted hover:text-binance-accent-yellow">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className="w-6 h-6">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m-4.5 4.5H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.615-2.23-1.666-2.75l-7.218-3.609a1.125 1.125 0 00-1.042 0L3.75 3.358c-1.051.52-1.666 1.615-1.666 2.75V19.5a2.25 2.25 0 002.25 2.25z" />
                    </svg>
                    <span className="text-xs mt-1">Markets</span>
                </button>
                <button onClick={() => navigate('tradePage')} className="flex flex-col items-center text-binance-text-muted hover:text-binance-accent-yellow">
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 6h18M3 12h18m-12 6h12" />
                    </svg>
                    <span className="text-xs mt-1">Trade</span>
                </button>
                <button onClick={() => showModal('Copy Trade functionality would be here.')} className="flex flex-col items-center text-binance-text-muted hover:text-binance-accent-yellow">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className="w-6 h-6">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 19.5a7.5 7.5 0 0114.998 0A8.25 8.25 0 0112 21.75a8.25 8.25 0 01-7.499-2.25z" />
                    </svg>
                    <span className="text-xs mt-1">Copy Trade</span>
                </button>
            </footer>
        );

        // --- TradingView Widget Component ---
        // This component dynamically embeds the TradingView Advanced Chart Widget.
        const TradingViewWidget = ({ symbol, interval = "1D", theme = "dark", height = 400 }) => {
            const containerRef = useRef(null); // Ref to the div where the widget will be mounted

            useEffect(() => {
                // Check if the TradingView script is already loaded to prevent multiple loads
                if (document.getElementById(`tradingview-widget-script-${symbol}`)) {
                    return;
                }

                // Clean up previous widget instance if the symbol changes
                if (containerRef.current) {
                    containerRef.current.innerHTML = ''; // Clear previous widget HTML
                }

                const script = document.createElement('script');
                script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js';
                script.type = 'text/javascript';
                script.async = true;
                script.id = `tradingview-widget-script-${symbol}`; // Unique ID for the script

                // Configuration for the TradingView widget
                script.innerHTML = JSON.stringify({
                    "autosize": true,
                    "symbol": symbol, // e.g., "BINANCE:BTCUSDT"
                    "interval": interval, // e.g., "1D", "1H", "4H"
                    "timezone": "Etc/UTC", // Consistent timezone
                    "theme": theme, // "dark" or "light"
                    "style": "1", // Candlestick chart style
                    "locale": "en",
                    "enable_publishing": false,
                    "withdateranges": true,
                    "range": "YTD", // Default range for the chart
                    "hide_side_toolbar": false,
                    "allow_symbol_change": true,
                    "details": true,
                    "hotlist": true,
                    "calendar": true,
                    "studies": ["Volume@tv-basicstudies"], // Add Volume indicator
                    "container_id": containerRef.current.id || `tradingview-widget-${symbol}-${Math.random().toString(36).substring(2, 9)}`, // Fallback for container_id
                });

                // Ensure the container has an ID for the widget to attach to
                if (!containerRef.current.id) {
                    containerRef.current.id = `tradingview-widget-${symbol}-${Math.random().toString(36).substring(2, 9)}`;
                }

                containerRef.current.appendChild(script);

                // Cleanup function: remove the script and clear the container on component unmount
                return () => {
                    if (containerRef.current) {
                        containerRef.current.innerHTML = '';
                    }
                    const existingScript = document.getElementById(`tradingview-widget-script-${symbol}`);
                    if (existingScript) {
                        existingScript.remove();
                    }
                };
            }, [symbol, interval, theme, height]); // Re-run effect if these props change

            return (
                <div
                    ref={containerRef}
                    className="tradingview-widget-container"
                    style={{ height: `${height}px`, width: '100%' }}
                >
                    <div className="tradingview-widget-container__widget" style={{ height: 'calc(100% - 32px)', width: '100%' }}></div>
                    {/* TradingView copyright will be added by the widget itself */}
                </div>
            );
        };

        // Component for quick action buttons with no icon - MOVED TO GLOBAL SCOPE
        const QuickActionBtn = ({ text, onClick, icon }) => (
            <button
                onClick={onClick}
                className="flex-1 bg-binance-bg-secondary text-binance-accent-yellow p-3 rounded-lg flex flex-col items-center justify-center space-y-1 hover:bg-zinc-700 transition-colors duration-200"
            >
                {icon}
                <span className="text-sm font-medium">{text}</span>
            </button>
        );


        // Landing Page: The initial page, minimalist with key action buttons.
        const LandingPage = ({ navigate }) => {
            const handleGetAppClick = () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            showModal('Binance Web3 Wallet PWA installation accepted!');
                        } else {
                            showModal('Binance Web3 Wallet PWA installation dismissed.');
                        }
                        deferredPrompt = null;
                    });
                } else {
                    showModal('PWA installation prompt not available. You might need to add to home screen manually.');
                    console.log('No deferredPrompt available.');
                }
            };

            return (
                <div className="min-h-screen pt-16 bg-binance-bg-primary text-binance-text-light transition-colors duration-300 flex items-center justify-center">
                    <section className="relative w-full text-white pt-24 pb-32 text-center overflow-hidden">
                        <div className="container mx-auto px-4 relative z-10">
                            <h1 className="text-4xl sm:text-5xl lg:text-6xl font-extrabold leading-tight mb-4">
                                Connect to Web3 with <span className="text-binance-accent-yellow">Binance</span>
                            </h1>
                            <p className="text-lg sm:text-xl text-white opacity-90 mb-8 max-w-3xl mx-auto">
                                Your secure portal to the decentralized world.
                            </p>
                            <div className="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-4">
                                {/* Connect Wallet Button - Primary Action */}
                                <button
                                    onClick={() => navigate('walletConnectPage', {fromLanding: true})} // Pass a flag
                                    className="px-8 py-4 w-48 bg-binance-accent-yellow text-binance-bg-primary font-semibold text-lg rounded-lg shadow-binance-md hover:opacity-90 transition-opacity duration-200 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow focus:ring-offset-2 focus:ring-offset-binance-bg-primary"
                                >
                                    Connect Wallet
                                </button>
                                {/* Removed Login Button as per instruction */}
                                {/* Removed Get App Button as per instruction */}
                            </div>
                        </div>
                        {/* Binance-like background gradient matching the provided link */}
                        {/* Updated to use custom dark blue and purple */}
                        <div className="absolute inset-0 bg-gradient-to-br from-binance-blue-dark/50 to-binance-purple-dark/50 opacity-50 blur-3xl"></div>
                        <div className="absolute inset-0 bg-gradient-to-br from-binance-blue-dark/10 via-binance-purple-dark/10 to-binance-blue-dark/10 opacity-70"></div>
                    </section>
                </div>
            );
        };

        // Dashboard Page: The main dashboard after a user logs in and connects wallet
        // Integrated the provided template for the Wallet Dashboard
        const DashboardPage = ({ navigate, openDepositModal, openWithdrawalModal, isDarkMode }) => {
            const { userStatus } = useContext(UserContext); // Access user status from context

            const [marketData, setMarketData] = useState([]);
            const [loadingMarket, setLoadingMarket] = useState(true);
            const [error, setError] = useState(null);

            // Fetch market data from CoinGecko API
            const fetchMarketData = useCallback(async () => {
                setLoadingMarket(true);
                setError(null);
                try {
                    const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&page=1&sparkline=false&price_change_percentage=24h');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    setMarketData(data.map(coin => ({
                        id: coin.id,
                        ticker: coin.symbol.toUpperCase(),
                        name: coin.name,
                        currentPrice: coin.current_price,
                        price: `$${coin.current_price.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`,
                        change: coin.price_change_percentage_24h_in_currency ? coin.price_change_percentage_24h_in_currency.toFixed(2) : '0.00',
                        isPositive: coin.price_change_percentage_24h_in_currency >= 0,
                        image: coin.image
                    })));
                } catch (e) {
                    console.error("Failed to fetch market data:", e);
                    setError("Failed to load market data. Please try again later. (CoinGecko API might be rate-limited or unavailable)");
                    // Fallback to simulated data if API fails
                    setMarketData([
                        { id: 'bitcoin', ticker: 'BTC', name: 'Bitcoin', currentPrice: 68000.00, price: '$68,000.00', change: '2.50', isPositive: true, image: 'https://assets.coingecko.com/coins/images/1/large/bitcoin.png' },
                        { id: 'ethereum', ticker: 'ETH', name: 'Ethereum', currentPrice: 3500.00, price: '$3,500.00', change: '1.80', isPositive: true, image: 'https://assets.coingecko.com/coins/images/279/large/ethereum.png' },
                        { id: 'binancecoin', ticker: 'BNB', name: 'BNB', currentPrice: 600.00, price: '$600.00', change: '-0.50', isPositive: false, image: 'https://assets.coingecko.com/coins/images/825/large/binance-coin-logo.png' },
                        { id: 'tether', ticker: 'USDT', name: 'TetherUS', currentPrice: 1.00, price: '$1.00', change: '0.01', isPositive: true, image: 'https://assets.coingecko.com/coins/images/325/large/Tether.png' },
                    ]);
                } finally {
                    setLoadingMarket(false);
                }
            }, []);

            useEffect(() => {
                fetchMarketData();
                // Refresh data every 60 seconds to stay within CoinGecko's free tier rate limits (~10-30 calls/minute)
                const intervalId = setInterval(fetchMarketData, 60000);
                return () => clearInterval(intervalId); // Cleanup on unmount
            }, [fetchMarketData]);


            // Calculate total USD balance from detailedBalances
            const calculateTotalUSD = useCallback(() => {
                const balances = userStatus.connectedWalletInfo?.detailedBalances || {};

                if (!marketData.length && Object.keys(balances).length === 0) {
                    return 0;
                }

                let total = 0;
                // Sum up balances based on fetched market data
                for (const coin of marketData) {
                    const balanceString = balances[coin.ticker] || `0 ${coin.ticker}`;
                    const amount = parseFloat(balanceString.split(' ')[0]);
                    if (!isNaN(amount) && coin.currentPrice) {
                        total += amount * coin.currentPrice;
                    }
                }
                // Add any hardcoded USDT if not already accounted for from fetched market data
                if (!marketData.some(coin => coin.ticker === 'USDT')) {
                    total += parseFloat((balances.USDT || '0 USDT').split(' ')[0]) || 0;
                }

                return total;
            }, [userStatus.connectedWalletInfo, marketData]);

            const totalAssetsValue = calculateTotalUSD();


            // Component for displaying individual market price updates
            const PriceUpdateItem = ({ symbol, name, price, change, isPositive, image }) => (
                <div className="flex justify-between items-center py-2 border-b border-binance-border last:border-b-0">
                    <div className="flex items-center space-x-3">
                        {image && <img src={image} alt={`${name} icon`} className="w-6 h-6 rounded-full" />}
                        <div>
                            <p className="font-medium text-binance-text-light">{symbol}</p>
                            <p className="text-xs text-binance-text-muted">{name}</p>
                        </div>
                    </div>
                    <div className="text-right">
                        <p className="font-medium text-binance-text-light">{price}</p>
                        <p className={`text-xs ${isPositive ? 'text-binance-green' : 'text-binance-red'}`}>{isPositive ? '+' : ''}{change}%</p>
                    </div>
                </div>
            );

            // Simulated user assets for the dashboard (in a real app, this would be from user's actual wallet)
            const getSimulatedUserAssets = useCallback(() => {
                const baseAssets = [
                    { id: 'binancecoin', ticker: 'BNB', name: 'Binance Coin', icon: 'https://assets.coingecko.com/coins/images/825/large/binance-coin-logo.png' },
                    { id: 'tether', ticker: 'USDT', name: 'Tether', icon: 'https://assets.coingecko.com/coins/images/325/large/Tether-logo.png' },
                    { id: 'bitcoin', ticker: 'BTC', name: 'Bitcoin', icon: 'https://assets.coingecko.com/coins/images/1/large/bitcoin.png' },
                    { id: 'ethereum', ticker: 'ETH', name: 'Ethereum', icon: 'https://assets.coingecko.com/coins/images/279/large/ethereum.png' },
                ];

                const balances = userStatus.connectedWalletInfo?.detailedBalances || {};

                return baseAssets.map(asset => {
                    const detailedBalance = balances[asset.ticker] || `0.00 ${asset.ticker}`;
                    const totalAmount = parseFloat(detailedBalance.split(' ')[0]);
                    const currentPriceData = marketData.find(m => m.ticker === asset.ticker);
                    const usdValue = currentPriceData ? (totalAmount * currentPriceData.currentPrice).toFixed(2) : '0.00';
                    return {
                        ...asset,
                        totalAmount: totalAmount,
                        usdValue: usdValue,
                    };
                });
            }, [userStatus.connectedWalletInfo, marketData]);

            const simulatedUserAssetBalances = getSimulatedUserAssets();

            const chartTheme = isDarkMode ? "dark" : "light";

            return (
                <div className="min-h-screen pt-16 bg-binance-bg-primary text-binance-text-light transition-colors duration-300">
                    <main className="p-4 space-y-4">
                        {/* Total Assets Card */}
                        <div className="card bg-binance-bg-secondary p-4 rounded-2xl shadow-lg border border-binance-border">
                            <h2 className="text-sm text-binance-text-muted font-medium">Total Assets</h2>
                            <p id="totalAssets" className="text-3xl mt-2 text-binance-accent-yellow font-bold">${totalAssetsValue.toFixed(2)}</p>
                        </div>

                        {/* Quick Action Buttons */}
                        <div className="flex justify-between space-x-2">
                            <QuickActionBtn
                                text={"Send"}
                                onClick={openWithdrawalModal} // Updated to open withdrawal modal
                                icon={<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M14 5l7 7m0 0l-7 7m7-7H3" /></svg>}
                            />
                            <QuickActionBtn
                                text={"Receive"}
                                onClick={openDepositModal}
                                icon={<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>}
                            />
                            <QuickActionBtn
                                text={"Convert"}
                                onClick={() => navigate('convertPage')} // Updated to navigate to ConvertPage
                                icon={<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" /></svg>}
                            />
                            <QuickActionBtn
                                text={"Swap"}
                                onClick={() => navigate('swapPage')} // Updated to navigate to SwapPage
                                icon={<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className="w-6 h-6"><path strokeLinecap="round" strokeLinejoin="round" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h18M16.5 3l4.5 4.5m0 0L16.5 12M21 7.5H3" /></svg>}
                            />
                        </div>

                        {/* Live Price Performance Chart (TradingView Widget) */}
                        <div className="bg-binance-surface-elevated p-5 rounded-xl shadow-lg border border-binance-border">
                            <h3 className="text-binance-accent-yellow font-bold text-lg mb-3">Live Price Performance (BTC/USDT)</h3>
                            {loadingMarket ? (
                                <div className="text-center py-8 text-binance-text-muted">Loading chart...</div>
                            ) : error ? (
                                <div className="text-center py-8 text-binance-red">{error}</div>
                            ) : (
                                <TradingViewWidget symbol="BINANCE:BTCUSDT" interval="1D" theme={chartTheme} height={300} />
                            )}
                        </div>

                        {/* Price Updates Section */}
                        <div className="bg-binance-surface-elevated p-5 rounded-xl shadow-lg border border-binance-border">
                            <h3 className="text-binance-accent-yellow font-bold text-lg mb-3">Price Updates</h3>
                            {loadingMarket ? (
                                <div className="text-center py-8 text-binance-text-muted">Loading price updates...</div>
                            ) : error ? (
                                <div className="text-center py-8 text-binance-red">{error}</div>
                            ) : (
                                <div className="space-y-2">
                                    {marketData.slice(0, 5).map((coin) => ( // Display top 5 coins
                                        <PriceUpdateItem key={coin.id} {...coin} />
                                    ))}
                                </div>
                            )}
                        </div>

                        {/* Your Assets Section */}
                        <div className="card bg-binance-bg-secondary p-4 rounded-2xl shadow-lg border border-binance-border">
                            <h3 className="text-lg font-semibold mb-3">Your Assets</h3>
                            <ul className="space-y-3">
                                {simulatedUserAssetBalances.map(asset => (
                                    <li key={asset.ticker} className="flex justify-between items-center">
                                        <div className="flex items-center space-x-3">
                                            <img src={asset.icon} alt={asset.name} className="w-8 h-8 rounded-full" />
                                            <div>
                                                <p className="font-medium text-binance-text-light">{asset.ticker}</p>
                                                <p className="text-xs text-binance-text-muted">{asset.name}</p>
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <p className="font-medium text-binance-text-light">{asset.totalAmount.toFixed(2)} {asset.ticker}</p>
                                            <p className="text-xs text-binance-text-muted">${asset.usdValue}</p>
                                        </div>
                                    </li>
                                ))}
                            </ul>
                        </div>

                        {/* Wallet Market Trend Chart (TradingView Widget) */}
                        <div className="card bg-binance-bg-secondary p-4 rounded-2xl shadow-lg border border-binance-border">
                            <h3 className="text-binance-accent-yellow font-bold text-lg mb-3">Market Trend (ETH/USDT)</h3>
                            {loadingMarket ? (
                                <div className="text-center py-8 text-binance-text-muted">Loading market trend chart...</div>
                            ) : error ? (
                                <div className="text-center py-8 text-binance-red">{error}</div>
                            ) : (
                                <TradingViewWidget symbol="BINANCE:ETHUSDT" interval="4H" theme={chartTheme} height={200} />
                            )}
                        </div>
                    </main>
                </div>
            );
        };

        // Trade Page - with live TradingView chart
        const TradePage = ({ navigate, isDarkMode }) => {
            const chartTheme = isDarkMode ? "dark" : "light";

            return (
                <div className="min-h-screen bg-binance-bg-primary pt-16 transition-colors duration-300">
                    <div className="container mx-auto px-4 py-8">
                        <h1 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Trade Crypto</h1>

                        {/* Trading Interface Simulation */}
                        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg mb-8 border border-binance-border">
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                {/* Chart Section (TradingView Widget) */}
                                <div className="lg:col-span-2">
                                    <h2 className="text-2xl font-bold text-binance-text-light mb-4">BTC/USDT Trading Chart</h2>
                                    <TradingViewWidget symbol="BINANCE:BTCUSDT" interval="1H" theme={chartTheme} height={300} />
                                </div>

                                {/* Order Form */}
                                <div className="bg-binance-surface-elevated p-4 rounded-lg border border-binance-border">
                                    <h2 className="text-xl font-bold text-binance-text-light mb-4">Place Order</h2>
                                    <div className="flex mb-4">
                                        <button className="flex-1 py-2 rounded-l-lg bg-binance-green text-white font-semibold hover:bg-green-600 transition-colors">Buy</button>
                                        <button className="flex-1 py-2 rounded-r-lg bg-binance-red text-white font-semibold hover:bg-red-600 transition-colors">Sell</button>
                                    </div>
                                    <div className="mb-4">
                                        <label htmlFor="price" className="block text-binance-text-muted text-sm font-medium mb-2">Price (USDT)</label>
                                        <input type="number" id="price" placeholder="Market" className="w-full px-4 py-3 rounded-lg bg-binance-bg-primary text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow" />
                                    </div>
                                    <div className="mb-4">
                                        <label htmlFor="amount" className="block text-binance-text-muted text-sm font-medium mb-2">Amount (BTC)</label>
                                        <input type="number" id="amount" placeholder="0.00" className="w-full px-4 py-3 rounded-lg bg-binance-bg-primary text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow" />
                                    </div>
                                    <button onClick={() => showModal('Simulating trade execution.')} className="w-full px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200">
                                        Buy BTC
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Order Book / Recent Trades (placeholder) */}
                        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg border border-binance-border">
                            <h2 className="text-2xl font-bold text-binance-text-light mb-4">Order Book / Recent Trades</h2>
                            <p className="text-binance-text-muted text-center py-8">
                                Order book and recent trades would be displayed here in a real application.
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        // Earn Page - with simulated chart
        const EarnPage = ({ navigate, isDarkMode }) => {
             const chartTheme = isDarkMode ? "dark" : "light";

            return (
                <div className="min-h-screen bg-binance-bg-primary pt-16 transition-colors duration-300">
                    <div className="container mx-auto px-4 py-8">
                        <h1 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Earn Passive Income</h1>

                        {/* Earn Products Overview */}
                        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg mb-8 border border-binance-border">
                            <h2 className="text-2xl font-bold text-binance-text-light mb-4">Popular Earn Products</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {/* Staking Card */}
                                <div className="bg-binance-surface-elevated p-5 rounded-lg border border-binance-border flex items-center justify-between">
                                    <div>
                                        <h3 className="text-xl font-semibold text-binance-text-light">Staking</h3>
                                        <p className="text-binance-text-muted">Earn rewards by holding crypto.</p>
                                    </div>
                                    <button onClick={() => showModal('Exploring staking options.')} className="px-4 py-2 bg-binance-green text-white rounded-lg hover:bg-green-600 transition-colors">Start Earning</button>
                                </div>
                                {/* Flexible Savings Card */}
                                <div className="bg-binance-surface-elevated p-5 rounded-lg border border-binance-border flex items-center justify-between">
                                    <div>
                                        <h3 className="text-xl font-semibold text-binance-text-light">Flexible Savings</h3>
                                        <p className="text-binance-text-muted">High flexibility, daily earnings.</p>
                                    </div>
                                    <button onClick={() => showModal('Exploring flexible savings.')} className="px-4 py-2 bg-binance-blue text-white rounded-lg hover:bg-blue-600 transition-colors">Deposit Now</button>
                                </div>
                            </div>
                        </div>

                        {/* Earn Performance Chart (TradingView Widget for BNB staking APY simulation - using a crypto chart) */}
                        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg mb-8 border border-binance-border">
                            <h2 className="text-2xl font-bold text-binance-text-light mb-4">BNB Staking APY (Simulated via BNB/USDT chart)</h2>
                            <TradingViewWidget symbol="BINANCE:BNBUSDT" interval="1D" theme={chartTheme} height={300} />
                        </div>

                        {/* More Earn Products (placeholder) */}
                        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg border border-binance-border">
                            <h2 className="text-2xl font-bold text-binance-text-light mb-4">Other Earn Products</h2>
                            <p className="text-binance-text-muted text-center py-8">
                                More diversified earning products like Launchpool, Liquid Swap would be here.
                            </p>
                            <div className="text-center">
                                <button onClick={() => showModal('Exploring all Earn products.')} className="px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200">
                                    View All Products
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- New: Convert Page ---
        const ConvertPage = ({ navigate, isDarkMode }) => {
            const chartTheme = isDarkMode ? "dark" : "light";
            const [fromAmount, setFromAmount] = useState('');
            const [toAmount, setToAmount] = useState('');
            const [fromAsset, setFromAsset] = useState('BTC');
            const [toAsset, setToAsset] = useState('USDT');
            const [isLoading, setIsLoading] = useState(false);

            // Simple simulated conversion rate
            const getConversionRate = (from, to) => {
                if (from === 'BTC' && to === 'USDT') return 70000;
                if (from === 'USDT' && to === 'BTC') return 1 / 70000;
                if (from === 'ETH' && to === 'USDT') return 3500;
                if (from === 'USDT' && to === 'ETH') return 1 / 3500;
                if (from === 'BNB' && to === 'USDT') return 600;
                if (from === 'USDT' && to === 'BNB') return 1 / 600;
                return 1; // Fallback for same asset or unsupported pairs
            };

            useEffect(() => {
                if (fromAmount) {
                    const rate = getConversionRate(fromAsset, toAsset);
                    setToAmount((parseFloat(fromAmount) * rate).toFixed(6));
                } else {
                    setToAmount('');
                }
            }, [fromAmount, fromAsset, toAsset]);


            const handleConvert = (e) => {
                e.preventDefault();
                setIsLoading(true);
                showModal(`Converting ${fromAmount} ${fromAsset} to ${toAmount} ${toAsset}...`);

                setTimeout(() => {
                    setIsLoading(false);
                    hideModal();
                    showModal('Conversion simulated successfully!');
                    // In a real app, update user balances here
                    setFromAmount('');
                    setToAmount('');
                }, 3000);
            };

            return (
                <div className="min-h-screen bg-binance-bg-primary pt-16 transition-colors duration-300">
                    <div className="container mx-auto px-4 py-8">
                        <h1 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Convert Crypto</h1>

                        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg mb-8 border border-binance-border max-w-lg mx-auto">
                            <p className="text-binance-text-muted mb-6 text-center">Instantly convert between cryptocurrencies.</p>
                            <form onSubmit={handleConvert}>
                                <div className="mb-4">
                                    <label htmlFor="fromAmount" className="block text-binance-text-light text-sm font-medium mb-2">From</label>
                                    <div className="flex rounded-lg border border-binance-border focus-within:ring-2 focus-within:ring-binance-accent-yellow bg-binance-surface-elevated">
                                        <input
                                            type="number"
                                            id="fromAmount"
                                            className="flex-1 px-4 py-3 bg-transparent text-binance-text-light focus:outline-none"
                                            placeholder="Amount"
                                            value={fromAmount}
                                            onChange={(e) => setFromAmount(e.target.value)}
                                            min="0"
                                            step="any"
                                            required
                                            disabled={isLoading}
                                        />
                                        <select
                                            className="p-3 bg-binance-bg-primary text-binance-text-light rounded-r-lg border-l border-binance-border focus:outline-none"
                                            value={fromAsset}
                                            onChange={(e) => setFromAsset(e.target.value)}
                                            disabled={isLoading}
                                        >
                                            <option value="BTC">BTC</option>
                                            <option value="ETH">ETH</option>
                                            <option value="BNB">BNB</option>
                                            <option value="USDT">USDT</option>
                                        </select>
                                    </div>
                                </div>

                                <div className="text-center my-4">
                                    <button
                                        type="button"
                                        onClick={() => {
                                            // Swap assets
                                            const tempAsset = fromAsset;
                                            setFromAsset(toAsset);
                                            setToAsset(tempAsset);
                                        }}
                                        className="p-2 rounded-full bg-binance-surface-elevated text-binance-text-light hover:bg-zinc-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                        aria-label="Swap assets"
                                        disabled={isLoading}
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className="w-6 h-6">
                                            <path strokeLinecap="round" strokeLinejoin="round" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h18M16.5 3l4.5 4.5m0 0L16.5 12M21 7.5H3" />
                                        </svg>
                                    </button>
                                </div>

                                <div className="mb-6">
                                    <label htmlFor="toAmount" className="block text-binance-text-light text-sm font-medium mb-2">To</label>
                                    <div className="flex rounded-lg border border-binance-border bg-binance-surface-elevated">
                                        <input
                                            type="number"
                                            id="toAmount"
                                            className="flex-1 px-4 py-3 bg-transparent text-binance-text-muted focus:outline-none"
                                            placeholder="Receivable amount"
                                            value={toAmount}
                                            readOnly
                                            disabled // Always disabled as it's calculated
                                        />
                                        <select
                                            className="p-3 bg-binance-bg-primary text-binance-text-light rounded-r-lg border-l border-binance-border focus:outline-none"
                                            value={toAsset}
                                            onChange={(e) => setToAsset(e.target.value)}
                                            disabled={isLoading}
                                        >
                                            <option value="USDT">USDT</option>
                                            <option value="BTC">BTC</option>
                                            <option value="ETH">ETH</option>
                                            <option value="BNB">BNB</option>
                                        </select>
                                    </div>
                                </div>

                                <button
                                    type="submit"
                                    className="w-full px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg shadow-binance-md hover:opacity-90 transition-opacity duration-200"
                                    disabled={isLoading || !fromAmount}
                                >
                                    {isLoading ? (
                                        <span className="flex items-center justify-center">
                                            <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-binance-bg-primary mr-3"></div>
                                            Converting...
                                        </span>
                                    ) : 'Convert Now'}
                                </button>
                            </form>
                        </div>
                        {/* TradingView Mini Chart for Price Trend */}
                        <div className="bg-binance-bg-secondary p-4 rounded-xl shadow-lg border border-binance-border mt-8">
                            <h3 className="text-binance-accent-yellow font-bold text-lg mb-3">BTC/USDT Price Trend</h3>
                            <TradingViewWidget symbol="BINANCE:BTCUSDT" interval="1D" theme={chartTheme} height={200} />
                        </div>
                    </div>
                </div>
            );
        };

        // --- New: Swap Page ---
        const SwapPage = ({ navigate, isDarkMode }) => {
            const chartTheme = isDarkMode ? "dark" : "light";
            const [fromAmount, setFromAmount] = useState('');
            const [toAmount, setToAmount] = useState('');
            const [fromAsset, setFromAsset] = useState('ETH');
            const [toAsset, setToAsset] = useState('BNB');
            const [isLoading, setIsLoading] = useState(false);

            // Simple simulated swap rate
            const getSwapRate = (from, to) => {
                if (from === 'ETH' && to === 'BNB') return 0.1; // 1 ETH = 0.1 BNB (example)
                if (from === 'BNB' && to === 'ETH') return 10;   // 1 BNB = 10 ETH (example)
                // Add more simulated rates as needed
                return 1;
            };

            useEffect(() => {
                if (fromAmount) {
                    const rate = getSwapRate(fromAsset, toAsset);
                    setToAmount((parseFloat(fromAmount) * rate).toFixed(6));
                } else {
                    setToAmount('');
                }
            }, [fromAmount, fromAsset, toAsset]);

            const handleSwap = (e) => {
                e.preventDefault();
                setIsLoading(true);
                showModal(`Swapping ${fromAmount} ${fromAsset} for ${toAmount} ${toAsset}...`);

                setTimeout(() => {
                    setIsLoading(false);
                    hideModal();
                    showModal('Swap simulated successfully!');
                    // In a real app, update user balances here
                    setFromAmount('');
                    setToAmount('');
                }, 3000);
            };

            return (
                <div className="min-h-screen bg-binance-bg-primary pt-16 transition-colors duration-300">
                    <div className="container mx-auto px-4 py-8">
                        <h1 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Swap Crypto</h1>

                        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg mb-8 border border-binance-border max-w-lg mx-auto">
                            <p className="text-binance-text-muted mb-6 text-center">Exchange one cryptocurrency for another.</p>
                            <form onSubmit={handleSwap}>
                                <div className="mb-4">
                                    <label htmlFor="fromSwapAmount" className="block text-binance-text-light text-sm font-medium mb-2">You Pay</label>
                                    <div className="flex rounded-lg border border-binance-border focus-within:ring-2 focus-within:ring-binance-accent-yellow bg-binance-surface-elevated">
                                        <input
                                            type="number"
                                            id="fromSwapAmount"
                                            className="flex-1 px-4 py-3 bg-transparent text-binance-text-light focus:outline-none"
                                            placeholder="Amount"
                                            value={fromAmount}
                                            onChange={(e) => setFromAmount(e.target.value)}
                                            min="0"
                                            step="any"
                                            required
                                            disabled={isLoading}
                                        />
                                        <select
                                            className="p-3 bg-binance-bg-primary text-binance-text-light rounded-r-lg border-l border-binance-border focus:outline-none"
                                            value={fromAsset}
                                            onChange={(e) => setFromAsset(e.target.value)}
                                            disabled={isLoading}
                                        >
                                            <option value="ETH">ETH</option>
                                            <option value="BNB">BNB</option>
                                            <option value="BTC">BTC</option>
                                            <option value="USDT">USDT</option>
                                        </select>
                                    </div>
                                </div>

                                <div className="text-center my-4">
                                    <button
                                        type="button"
                                        onClick={() => {
                                            const tempAsset = fromAsset;
                                            setFromAsset(toAsset);
                                            setToAsset(tempAsset);
                                        }}
                                        className="p-2 rounded-full bg-binance-surface-elevated text-binance-text-light hover:bg-zinc-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                        aria-label="Swap assets"
                                        disabled={isLoading}
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className="w-6 h-6">
                                            <path strokeLinecap="round" strokeLinejoin="round" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h18M16.5 3l4.5 4.5m0 0L16.5 12M21 7.5H3" />
                                        </svg>
                                    </button>
                                </div>

                                <div className="mb-6">
                                    <label htmlFor="toSwapAmount" className="block text-binance-text-light text-sm font-medium mb-2">You Receive</label>
                                    <div className="flex rounded-lg border border-binance-border bg-binance-surface-elevated">
                                        <input
                                            type="number"
                                            id="toSwapAmount"
                                            className="flex-1 px-4 py-3 bg-transparent text-binance-text-muted focus:outline-none"
                                            placeholder="Receivable amount"
                                            value={toAmount}
                                            readOnly
                                            disabled
                                        />
                                        <select
                                            className="p-3 bg-binance-bg-primary text-binance-text-light rounded-r-lg border-l border-binance-border focus:outline-none"
                                            value={toAsset}
                                            onChange={(e) => setToAsset(e.target.value)}
                                            disabled={isLoading}
                                        >
                                            <option value="BNB">BNB</option>
                                            <option value="ETH">ETH</option>
                                            <option value="USDT">USDT</option>
                                            <option value="BTC">BTC</option>
                                        </select>
                                    </div>
                                </div>

                                <button
                                    type="submit"
                                    className="w-full px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg shadow-binance-md hover:opacity-90 transition-opacity duration-200"
                                    disabled={isLoading || !fromAmount}
                                >
                                    {isLoading ? (
                                        <span className="flex items-center justify-center">
                                            <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-binance-bg-primary mr-3"></div>
                                            Swapping...
                                        </span>
                                    ) : 'Swap Now'}
                                </button>
                            </form>
                        </div>

                        {/* TradingView Mini Chart for Swap Pair Price Trend */}
                        <div className="bg-binance-bg-secondary p-4 rounded-xl shadow-lg border border-binance-border mt-8">
                            <h3 className="text-binance-accent-yellow font-bold text-lg mb-3">ETH/BNB Price Trend</h3>
                            <TradingViewWidget symbol="BINANCE:ETHBNB" interval="1D" theme={chartTheme} height={200} />
                        </div>
                    </div>
                </div>
            );
        };


        // Login Page: User authentication form
        const LoginPage = ({ navigate, setUserStatus }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const handleLogin = (e) => {
                e.preventDefault(); // Prevent default form submission
                setIsLoading(true);
                showModal('Logging in...');

                setTimeout(() => {
                    setIsLoading(false);
                    hideModal();
                    // Simulate successful login, no wallet connected initially
                    setUserStatus(prevStatus => ({ ...prevStatus, isLoggedIn: true }));
                    navigate('dashboardPage'); // After login, user is directed to Dashboard
                }, 3000); // Simulate login delay
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 transition-colors duration-300 p-4">
                    <div className="bg-binance-bg-secondary p-8 rounded-xl shadow-binance-lg w-11/12 max-w-md border border-binance-border">
                        <h2 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Log In</h2>
                        <form onSubmit={handleLogin}>
                            <div className="mb-4">
                                <label htmlFor="email" className="block text-binance-text-light text-sm font-medium mb-2">Email / Mobile</label>
                                <input
                                    type="text"
                                    id="email"
                                    className="w-full px-4 py-3 rounded-lg bg-binance-surface-elevated text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                    placeholder="Enter email or mobile"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    required
                                />
                            </div>
                            <div className="mb-6">
                                <label htmlFor="password" className="block text-binance-text-light text-sm font-medium mb-2">Password</label>
                                <input
                                    type="password"
                                    id="password"
                                    className="w-full px-4 py-3 rounded-lg bg-binance-surface-elevated text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                    placeholder="Enter password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                />
                            </div>
                            <button
                                type="submit"
                                className="w-full px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg shadow-binance-md hover:opacity-90 transition-opacity duration-200 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                disabled={isLoading}
                            >
                                {isLoading ? (
                                    <span className="flex items-center justify-center">
                                        <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-binance-bg-primary mr-3"></div>
                                        Logging In...
                                    </span>
                                ) : 'Log In'}
                            </button>
                            <p className="text-center text-sm text-binance-text-muted mt-4">
                                {/* "Register Now" redirects to login page with a message, as no separate registration flow is intended */}
                                Don't have an account? <a href="#" onClick={(e) => { e.preventDefault(); showModal('This would typically lead to a registration form in a full application. For this demo, please use the login above.'); }} className="text-binance-accent-yellow hover:underline">Register Now</a>
                            </p>
                        </form>
                    </div>
                </div>
            );
        };

        // Wallet Connect Page: Integrated from the provided HTML file, converted to React
        const WalletConnectPage = ({ navigate, setUserStatus, fromLanding }) => {
            const { userStatus } = useContext(UserContext);
            const [activeSection, setActiveSection] = useState('walletconnect'); // Controls tabs: 'walletconnect' or 'manual'
            const [walletConnectStatus, setWalletConnectStatus] = useState("Connect your Ethereum wallet via WalletConnect.");
            const [isWalletConnectLoading, setIsWalletConnectLoading] = useState(false);
            const [isManualLoading, setIsManualLoading] = useState(false);

            // States for manual connection
            const [selectedNetworkId, setSelectedNetworkId] = useState('');
            const [manualAddressInput, setManualAddressInput] = useState('');

            // Network configurations, derived from the provided file
            const networks = [
                { id: 'btc', name: 'Bitcoin (BTC)', type: 'non-evm', symbol: 'BTC', api: 'https://api.blockcypher.com/v1/btc/main/addrs/' },
                { id: 'eth-erc20', name: 'Ethereum (ETH ERC20)', type: 'evm', symbol: 'ETH', rpc: 'https://mainnet.infura.io/v3/YOUR_INFURA_PROJECT_ID' },
                { id: 'bnb-bep20', name: 'BNB Smart Chain (BSC BEP20)', type: 'evm', symbol: 'BNB', rpc: 'https://bsc-dataseed.binance.org/' },
                { id: 'tron-trc20', name: 'TRON (TRX TRC20)', type: 'non-evm', symbol: 'TRX', api: 'https://api.trongrid.io/wallet/getaccount' },
                { id: 'sol', name: 'Solana (SOL)', type: 'non-evm', symbol: 'SOL', rpc: 'https://api.mainnet-beta.solana.com' },
                { id: 'polygon', name: 'Polygon (MATIC)', type: 'evm', symbol: 'MATIC', rpc: 'https://polygon-rpc.com/' },
                { id: 'avalanche', name: 'Avalanche C-Chain (AVAX)', type: 'evm', symbol: 'AVAX', rpc: 'https://api.avax.network/ext/bc/C/rpc' },
                { id: 'arbitrum', name: 'Arbitrum One (ARB)', type: 'evm', symbol: 'ETH', rpc: 'https://arb1.arbitrum.io/rpc' },
                { id: 'optimism', name: 'Optimism (OP)', type: 'evm', symbol: 'ETH', rpc: 'https://mainnet.optimism.io' },
                { id: 'fantom', name: 'Fantom (FTM)', type: 'evm', symbol: 'FTM', rpc: 'https://rpc.ftm.tools/' },
                { id: 'polkadot', name: 'Polkadot (DOT)', type: 'non-evm', symbol: 'DOT', api: 'N/A' },
                { id: 'cosmos', name: 'Cosmos (ATOM)', type: 'non-evm', symbol: 'ATOM', api: 'N/A' },
                { id: 'cardano', name: 'Cardano (ADA)', type: 'non-evm', symbol: 'ADA', api: 'N/A' },
                { id: 'xrp', name: 'XRP Ledger (XRP)', type: 'non-evm', symbol: 'XRP', api: 'N/A' },
                { id: 'near', name: 'Near Protocol (NEAR)', type: 'non-evm', symbol: 'NEAR', api: 'N/A' }
            ];

            // Effect to update local state if userStatus changes externally (e.g., disconnect from header)
            useEffect(() => {
                if (!userStatus.connectedWalletInfo) {
                    setWalletConnectStatus("Connect your Ethereum wallet via WalletConnect.");
                    // Reset manual connection form too
                    setSelectedNetworkId('');
                    setManualAddressInput('');
                } else {
                    // Set the active tab based on how the wallet was last connected
                    if (userStatus.connectedWalletInfo.type === 'manual') {
                        setActiveSection('manual');
                        setSelectedNetworkId(networks.find(n => n.name === userStatus.connectedWalletInfo.network)?.id || '');
                        setManualAddressInput(userStatus.connectedWalletInfo.address || '');
                    } else {
                        setActiveSection('walletconnect');
                    }
                }
            }, [userStatus.connectedWalletInfo]);

            // Simulate immediate connection and balance fetch if coming from landing page "Connect Wallet"
            useEffect(() => {
                if (fromLanding && !userStatus.connectedWalletInfo) {
                    const simulatedAddress = '0x1234567890abcdef1234567890abcdef12345678';
                    const simulatedBalances = {
                        BNB: '0.5 BNB',
                        ETH: '0.12 ETH',
                        BTC: '0.005 BTC',
                        USDT: '5105.78 USDT' // Specific USDT balance
                    };
                    showModal('Connecting wallet from landing page...');
                    setTimeout(() => {
                        setUserStatus(prevStatus => ({
                            ...prevStatus,
                            isLoggedIn: true, // Auto-login if coming from landing page connect
                            connectedWalletInfo: {
                                address: simulatedAddress,
                                balance: simulatedBalances.USDT, // Total balance as USDT
                                network: 'Multi-Chain (Simulated)',
                                type: 'walletconnect-landing',
                                detailedBalances: simulatedBalances // Store detailed balances
                            }
                        }));
                        hideModal();
                        showModal('Wallet connected successfully from Get Started page!');
                        navigate('dashboardPage'); // Redirect to dashboard page
                    }, 2000); // Short delay for UX
                }
            }, [fromLanding, userStatus.connectedWalletInfo, navigate, setUserStatus]);


            // --- WalletConnect Logic ---
            const handleConnectWallet = async () => {
                // Access control: User must be logged in
                if (!userStatus.isLoggedIn) {
                    showModal('Please log in first to connect your wallet.');
                    navigate('loginPage');
                    return;
                }

                setIsWalletConnectLoading(true);
                setWalletConnectStatus('Connecting via Wallet App...');
                showModal('Opening WalletConnect modal to connect your wallet...');

                try {
                    const provider = new WalletConnectProvider.default({
                        projectId: "0e0d74e5227e248cffdc16006c9e7e2f", // Placeholder Project ID
                        chains: [1], // Example: Ethereum Mainnet (chain ID)
                        infuraId: "YOUR_INFURA_PROJECT_ID", // IMPORTANT: Replace with your actual Infura Project ID
                        showQrModal: true
                    });

                    // Simulate 30-second loading before WalletConnect modal appears (if it would)
                    await new Promise(resolve => setTimeout(resolve, 30000));

                    await provider.enable();
                    const web3 = new Web3(provider);
                    const accounts = await web3.eth.getAccounts();

                    if (accounts.length > 0) {
                        const account = accounts[0];
                        const simulatedBalances = {
                            BNB: '0.5 BNB',
                            ETH: '0.12 ETH',
                            BTC: '0.005 BTC',
                            USDT: '5105.78 USDT'
                        };
                        setWalletConnectStatus('You\'re connected!');

                        // Update global user status
                        setUserStatus(prevStatus => ({
                            ...prevStatus,
                            isLoggedIn: true, // Ensure user is logged in
                            connectedWalletInfo: {
                                address: account,
                                balance: simulatedBalances.USDT, // Total balance as USDT
                                network: 'Ethereum',
                                type: 'walletconnect',
                                detailedBalances: simulatedBalances
                            }
                        }));
                        hideModal(); // Hide the initial connecting modal
                        showModal(`Successfully connected to: ${account}`);
                        navigate('dashboardPage'); // Navigate to dashboard after successful connection
                    } else {
                        showModal("No accounts found. Please try connecting again.");
                        setWalletConnectStatus("Failed to connect wallet.");
                    }

                } catch (error) {
                    console.error("Wallet connection failed:", error);
                    let errorMessage = "An unknown error occurred.";
                    if (error.message && error.message.includes("User closed modal")) {
                        errorMessage = "WalletConnect modal was closed. Please try again to connect.";
                    } else if (error.message) {
                        errorMessage = error.message;
                    } else if (error.code) {
                        errorMessage = `Error Code: ${error.code}`;
                    }
                    setWalletConnectStatus("Failed to connect wallet.");
                    hideModal(); // Ensure modal is hidden on error
                } finally {
                    setIsWalletConnectLoading(false);
                }
            };

            // --- Manual Connect Logic ---
            const handleManualConnect = async () => {
                // Access control: User must be logged in
                if (!userStatus.isLoggedIn) {
                    showModal('Please log in first to connect your wallet manually.');
                    navigate('loginPage');
                    return;
                }

                const address = manualAddressInput.trim();
                if (!selectedNetworkId) {
                    showModal('Please select a network.');
                    return;
                }
                if (!address) {
                    showModal('Please enter a wallet address.');
                    return;
                }

                setIsManualLoading(true);
                showModal('Connecting wallet and fetching balance, please wait (30 seconds simulation)...'); // Updated message

                // Simulate 30-second loading
                await new Promise(resolve => setTimeout(resolve, 30000));

                const network = networks.find(n => n.id === selectedNetworkId);
                const simulatedBalances = {
                    BNB: `${(Math.random() * 2).toFixed(4)} BNB`,
                    ETH: `${(Math.random() * 0.5).toFixed(4)} ETH`,
                    BTC: `${(Math.random() * 0.01).toFixed(4)} BTC`,
                    USDT: '5105.78 USDT' // Hardcoded USDT balance
                };

                // For manual connect, we'll assign simulated balances
                const balance = simulatedBalances.USDT; // Primary balance displayed is USDT
                setIsManualLoading(false);
                hideModal();

                // Update global user status with detailed balances
                setUserStatus(prevStatus => ({
                    ...prevStatus,
                    isLoggedIn: true, // Ensure user is logged in
                    connectedWalletInfo: {
                        address: address,
                        balance: balance,
                        network: network.name,
                        type: 'manual',
                        detailedBalances: simulatedBalances // Store detailed balances
                    }
                }));

                showModal(`Manually connected to ${network.name} with address ${address}.`);
                navigate('dashboardPage'); // Redirect to dashboard after manual connection
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 p-4 transition-colors duration-300">
                    <div className="bg-binance-bg-secondary p-8 rounded-2xl shadow-binance-lg max-w-md w-full text-center border border-binance-border">
                        <h1 className="text-3xl font-extrabold text-binance-text-light mb-6">Connect Your Wallet</h1>

                        {/* Tab Toggle Buttons */}
                        <div className="flex justify-center gap-4 mb-6">
                            <button
                                onClick={() => setActiveSection('walletconnect')}
                                className={`px-6 py-3 rounded-xl font-semibold shadow-binance-md transition duration-300 ${activeSection === 'walletconnect' ? 'bg-binance-accent-yellow text-binance-bg-primary' : 'bg-binance-surface-elevated text-binance-text-light hover:bg-zinc-700'}`}
                            >
                                Connect via Wallet App
                            </button>
                            <button
                                onClick={() => setActiveSection('manual')}
                                className={`px-6 py-3 rounded-xl font-semibold shadow-binance-md transition duration-300 ${activeSection === 'manual' ? 'bg-binance-accent-yellow text-binance-bg-primary' : 'bg-binance-surface-elevated text-binance-text-light hover:bg-zinc-700'}`}
                            >
                                Manual Connect
                            </button>
                        </div>

                        <hr className="my-6 border-binance-border" />

                        {/* WalletConnect Section Content */}
                        {activeSection === 'walletconnect' && (
                            <div className="flex flex-col items-center">
                                <div id="status-message" className="mb-6 text-lg text-binance-text-muted">
                                    {walletConnectStatus}
                                </div>

                                {(userStatus.connectedWalletInfo && userStatus.connectedWalletInfo.type === 'walletconnect') ? (
                                    <div className="mt-8 p-4 bg-binance-surface-elevated border border-binance-border rounded-xl w-full">
                                        <h2 className="text-xl font-semibold text-binance-text-light mb-2">Wallet Connected! </h2>
                                        <p className="text-binance-text-muted break-all">
                                            <span className="font-medium">Address:</span> <span className="text-binance-accent-yellow font-mono">{userStatus.connectedWalletInfo.address}</span>
                                        </p>
                                        <p className="text-binance-text-muted break-all mt-1">
                                            <span className="font-medium">Balance:</span> <span className="text-binance-accent-yellow font-mono">{userStatus.connectedWalletInfo.balance}</span>
                                        </p>
                                        <button
                                            onClick={() => navigate('connectedWalletDetails')}
                                            className="mt-4 bg-binance-green hover:bg-green-700 text-white font-bold py-2 px-4 rounded-xl shadow-binance-md"
                                        >
                                            View Connected Wallet
                                        </button>
                                    </div>
                                ) : (
                                    <>
                                        <button
                                            onClick={handleConnectWallet}
                                            className="bg-binance-accent-yellow hover:opacity-90 text-binance-bg-primary font-bold py-3 px-6 rounded-xl shadow-binance-md
                                                       transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-binance-accent-yellow
                                                       w-full"
                                            disabled={isWalletConnectLoading || !userStatus.isLoggedIn}
                                        >
                                            {isWalletConnectLoading ? (
                                                <span className="flex items-center justify-center">
                                                    <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-binance-bg-primary mr-3"></div>
                                                    Connecting...
                                                </span>
                                            ) : (
                                                `Connect Wallet`
                                            )}
                                        </button>
                                        {!userStatus.isLoggedIn && (
                                            <p className="text-sm text-binance-text-muted mt-4">
                                                Please <a href="#" onClick={(e) => { e.preventDefault(); navigate('loginPage'); }} className="text-binance-accent-yellow hover:underline">Log In</a> first to enable wallet connection.
                                            </p>
                                        )}
                                    </>
                                )}
                            </div>
                        )}

                        {/* Manual Connect Section Content */}
                        {activeSection === 'manual' && (
                            <div className="flex flex-col items-center mt-8">
                                <h2 className="text-2xl font-bold text-binance-text-light mb-4">Manual Wallet Connection</h2>
                                <p className="text-sm text-binance-red mb-4 text-center p-2 bg-red-900/20 rounded-lg border border-red-700">
                                    Note: Manual connection is primarily for **viewing balances** and does not enable transactions or signing messages.
                                    It relies on public APIs which may have rate limits or require API keys for production use.
                                </p>

                                {(userStatus.connectedWalletInfo && userStatus.connectedWalletInfo.type === 'manual') ? (
                                    <div className="mt-8 p-4 bg-binance-surface-elevated border border-binance-border rounded-xl w-full text-left">
                                        <h2 className="text-xl font-semibold text-binance-text-light mb-2">Wallet Connected! </h2>
                                        <p className="text-binance-text-muted break-all">
                                            <span className="font-medium">Network:</span> <span className="text-binance-accent-yellow">{userStatus.connectedWalletInfo.network}</span>
                                        </p>
                                        <p className="text-binance-text-muted break-all mb-2">
                                            <span className="font-medium">Address:</span> <span className="text-binance-accent-yellow font-mono">{userStatus.connectedWalletInfo.address}</span>
                                        </p>
                                        <p className="text-binance-text-muted break-all">
                                            <span className="font-medium">Balance:</span> <span className="text-binance-accent-yellow font-mono">{userStatus.connectedWalletInfo.balance}</span>
                                        </p>
                                        <button
                                            onClick={() => navigate('connectedWalletDetails')}
                                            className="mt-4 bg-binance-green hover:bg-green-700 text-white font-bold py-2 px-4 rounded-xl shadow-binance-md"
                                        >
                                            View Connected Wallet
                                        </button>
                                    </div>
                                ) : (
                                    <>
                                        <div className="w-full max-w-sm mb-4">
                                            <label htmlFor="network-select" className="block text-left text-binance-text-muted text-sm font-bold mb-2">Select Network:</label>
                                            <select
                                                id="network-select"
                                                className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-binance-text-light leading-tight
                                                           focus:outline-none focus:shadow-outline focus:ring-2 focus:ring-binance-accent-yellow bg-binance-bg-primary border-binance-border"
                                                value={selectedNetworkId}
                                                onChange={(e) => {
                                                    setSelectedNetworkId(e.target.value);
                                                    setManualAddressInput('');
                                                }}
                                                disabled={!userStatus.isLoggedIn}
                                            >
                                                <option value="">Select a Network</option>
                                                {networks.map(network => (
                                                    <option key={network.id} value={network.id}>{network.name}</option>
                                                ))}
                                            </select>
                                        </div>

                                        {selectedNetworkId && (
                                            <div className="w-full max-w-sm mb-4">
                                                <label htmlFor="wallet-address-input" className="block text-left text-binance-text-muted text-sm font-bold mb-2">Enter Address:</label>
                                                <input
                                                    type="text"
                                                    id="address"
                                                    className="w-full px-4 py-3 rounded-lg bg-binance-surface-elevated text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                                    placeholder="Enter wallet address"
                                                    value={manualAddressInput}
                                                    onChange={(e) => setManualAddressInput(e.target.value)}
                                                    required
                                                    disabled={!userStatus.isLoggedIn}
                                                />
                                            </div>
                                        )}

                                        {selectedNetworkId && (
                                            <button
                                                onClick={handleManualConnect}
                                                className="bg-binance-green hover:bg-green-700 text-white font-bold py-3 px-6 rounded-xl shadow-binance-md
                                                           transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-binance-green
                                                           w-full max-w-sm"
                                                disabled={isManualLoading || !userStatus.isLoggedIn}
                                            >
                                                {isManualLoading ? (
                                                    <span className="flex items-center justify-center">
                                                        <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-binance-bg-primary mr-3"></div>
                                                        Fetching...
                                                    </span>
                                                ) : (
                                                    `Connect Manually`
                                                )}
                                            </button>
                                        )}
                                        {!userStatus.isLoggedIn && (
                                            <p className="text-sm text-binance-text-muted mt-4">
                                                Please <a href="#" onClick={(e) => { e.preventDefault(); navigate('loginPage'); }} className="text-binance-accent-yellow hover:underline">Log In</a> first to enable manual connection.
                                            </p>
                                        )}
                                    </>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Connected Wallet Details Page
        const ConnectedWalletDetailsPage = ({ navigate, setUserStatus }) => {
            const { userStatus } = useContext(UserContext);
            const connectedWalletInfo = userStatus.connectedWalletInfo;

            // Effect to redirect if no wallet is connected
            useEffect(() => {
                if (!connectedWalletInfo) {
                    showModal('No wallet connected. Redirecting to connection options.');
                    navigate('walletConnectPage');
                }
            }, [connectedWalletInfo, navigate]);

            if (!connectedWalletInfo) {
                return null; // Don't render if no wallet connected yet, will redirect via useEffect
            }

            const handleDisconnect = () => {
                showModal('Disconnecting wallet...');
                setTimeout(() => {
                    setUserStatus(prevStatus => ({ ...prevStatus, connectedWalletInfo: null, transactions: [] }));
                    showModal('Wallet disconnected successfully!');
                    hideModal();
                    navigate('walletConnectPage'); // Redirect to wallet connect options
                }, 1500);
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 p-4 transition-colors duration-300">
                    <div className="bg-binance-bg-secondary p-8 rounded-2xl shadow-binance-lg max-w-md w-full text-center border border-binance-border">
                        <h1 className="text-3xl font-extrabold text-binance-text-light mb-6">Connected Wallet Details</h1>

                        <div className="mb-6 p-4 bg-binance-surface-elevated rounded-xl border border-binance-border text-left">
                            <p className="text-binance-text-muted mb-2">
                                <span className="font-medium text-binance-text-light">Address:</span> <span className="font-mono text-binance-accent-yellow break-all">{connectedWalletInfo.address}</span>
                            </p>
                            <p className="text-binance-text-muted mb-4">
                                <span className="font-medium text-binance-text-light">Network:</span> <span className="text-binance-text-light">{connectedWalletInfo.network}</span>
                            </p>
                            <h2 className="text-xl font-bold text-binance-text-light mb-3">Balances:</h2>
                            <ul className="space-y-2">
                                {Object.entries(connectedWalletInfo.detailedBalances).map(([asset, balance]) => (
                                    <li key={asset} className="flex justify-between text-binance-text-light">
                                        <span>{asset}:</span>
                                        <span className="font-mono">{balance}</span>
                                    </li>
                                ))}
                            </ul>
                        </div>

                        <button
                            onClick={handleDisconnect}
                            className="w-full px-6 py-3 bg-binance-red text-white font-semibold rounded-lg shadow-binance-md hover:bg-red-600 transition-colors duration-200 mt-4"
                        >
                            Disconnect Wallet
                        </button>
                    </div>
                </div>
            );
        };


        // Deposit Page Component: Displays network addresses and QR codes for deposits
        const DepositPage = ({ navigate, onClose }) => {
            const addresses = {
                ETH: "0xB36EDa1ffC696FFba07D4Be5cd249FE5E0118130",
                BTC: "bc1qv4fffwt8ux3k33n2dms5cdvuh6suc0gtfevxzu",
                BNB: "0xB36EDa1ffC696FFba07D4Be5cd249FE5E0118130", // Assuming same as ETH for simplicity as it's also EVM-compatible
                USDT_TRON: "TSt7yoNwGYRbtMMfkSAHE6dPs1cd9rxcco",
            };

            // This component will render a QR code for a given address
            const QRCodeDisplay = ({ id, address }) => {
                const qrCodeRef = useRef(null);
                const [showAddress, setShowAddress] = useState(false); // State to toggle address visibility

                useEffect(() => {
                    // Ensure QRCode is loaded and ref is available
                    if (window.QRCode && qrCodeRef.current) {
                        // Clear previous QR code if any
                        qrCodeRef.current.innerHTML = '';
                        // Create new QR code
                        new window.QRCode(qrCodeRef.current, {
                            text: address,
                            width: 128,
                            height: 128,
                            colorDark: "#e0e0e0", // Binance text light for dark mode
                            colorLight: "#121212", // Binance background primary for dark mode
                            correctLevel: window.QRCode.CorrectLevel.H
                        });
                    }
                }, [address]); // Re-generate QR code if address changes

                const handleCopyClick = () => {
                    // Fallback for document.execCommand('copy') as navigator.clipboard.writeText()
                    // might not work in some iframe environments.
                    const dummyTextArea = document.createElement("textarea");
                    dummyTextArea.value = address;
                    document.body.appendChild(dummyTextArea);
                    dummyTextArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(dummyTextArea);
                    showModal('Address copied to clipboard!');
                };

                return (
                    <div className="bg-binance-surface-elevated p-4 rounded-lg shadow-binance-sm border border-binance-border text-center flex flex-col items-center">
                        <h3 className="text-xl font-semibold text-binance-text-light mb-3">{id}</h3>
                        <div ref={qrCodeRef} className="mb-3 p-2 bg-binance-bg-primary rounded"></div> {/* QR code render target */}
                        {showAddress && (
                            <p className="text-sm text-binance-text-muted break-all font-mono mb-3 animate-fade-in-up">
                                {address}
                            </p>
                        )}
                        <button
                            onClick={() => setShowAddress(!showAddress)}
                            className="px-4 py-2 bg-binance-blue text-white font-semibold rounded-lg hover:bg-blue-600 transition-colors duration-200 mb-2 w-full"
                        >
                            {showAddress ? 'Hide Address' : 'Show Address'}
                        </button>
                        {showAddress && (
                            <button
                                onClick={handleCopyClick}
                                className="px-4 py-2 bg-binance-green text-white font-semibold rounded-lg hover:bg-green-600 transition-colors duration-200 w-full"
                            >
                                Copy Address
                            </button>
                        )}
                    </div>
                );
            };

            return (
                <div className="py-2">
                    <h1 className="text-3xl font-bold text-binance-text-light mb-4 text-center">Deposit Funds</h1>
                    <p className="text-lg text-binance-text-muted mb-6 text-center">
                        Select the cryptocurrency you wish to deposit. Scan the QR code or click 'Show Address' and copy.
                        Ensure the network matches to avoid loss of funds.
                    </p>
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-4">
                        {Object.entries(addresses).map(([networkName, addr]) => (
                            <QRCodeDisplay key={networkName} id={networkName} address={addr} />
                        ))}
                    </div>
                    <div className="text-center mt-6">
                        <button
                            onClick={onClose}
                            className="px-6 py-3 w-48 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200"
                        >
                            Close
                        </button>
                    </div>
                </div>
            );
        };

        // Utility function to format countdown time
        const formatTime = (totalSeconds) => {
            const days = Math.floor(totalSeconds / (3600 * 24));
            const hours = Math.floor((totalSeconds % (3600 * 24)) / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = Math.floor(totalSeconds % 60);

            const pad = (num) => num.toString().padStart(2, '0');

            if (days > 0) {
                return `${days}D ${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
            } else {
                return `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
            }
        };

        // Withdrawal Processing Page Component (Modal Content)
        const WithdrawalProcessingPage = ({ withdrawalDetails, onClose, onWithdrawalComplete }) => {
            // Simulated 36 hours in seconds for display purposes
            const SIMULATED_TOTAL_SECONDS = 36 * 3600;
            // For the demo, make the countdown fast, e.g., 5 seconds = 36 hours
            const SIMULATED_DURATION_SECONDS = 5; // Total actual seconds for demo countdown
            const SIMULATED_PROGRESS_PER_SECOND = SIMULATED_TOTAL_SECONDS / SIMULATED_DURATION_SECONDS;

            const [remainingSeconds, setRemainingSeconds] = useState(SIMULATED_TOTAL_SECONDS);

            useEffect(() => {
                const interval = setInterval(() => {
                    setRemainingSeconds(prev => {
                        const newRemaining = prev - SIMULATED_PROGRESS_PER_SECOND;
                        if (newRemaining <= 0) {
                            clearInterval(interval);
                            onWithdrawalComplete(withdrawalDetails.id); // Notify App about completion
                            return 0;
                        }
                        return newRemaining;
                    });
                }, 1000); // Update every second

                // Auto-close modal after 10 seconds and redirect to dashboard
                const redirectTimer = setTimeout(() => {
                    onClose(); // Close the modal
                }, 10000); // 10 seconds as requested

                return () => {
                    clearInterval(interval);
                    clearTimeout(redirectTimer);
                };
            }, [withdrawalDetails.id, onWithdrawalComplete, onClose]); // Dependencies for useEffect

            return (
                <div className="p-4">
                    <h2 className="text-2xl font-bold text-binance-text-light mb-4 text-center">Withdrawal Processing </h2>
                    <p className="text-lg text-binance-text-muted mb-4 text-center">
                        Your withdrawal of <span className="text-binance-accent-yellow font-semibold">{withdrawalDetails.amount} {withdrawalDetails.asset}</span> to <span className="text-binance-accent-yellow font-mono break-all">{withdrawalDetails.address}</span> is being processed.
                    </p>
                    <div className="text-center bg-binance-surface-elevated p-4 rounded-lg border border-binance-border mb-6">
                        <p className="text-binance-text-light text-xl font-bold">Remaining Time:</p>
                        <p className="text-binance-green text-3xl font-extrabold mt-2">
                            {formatTime(remainingSeconds)}
                        </p>
                        <p className="text-sm text-binance-text-muted mt-2">
                            (Estimated {SIMULATED_TOTAL_SECONDS / 3600} hours for completion - this is a visual simulation and does not persist offline)
                        </p>
                    </div>
                    <p className="text-binance-text-muted text-sm text-center">
                        You will be redirected to the dashboard shortly.
                    </p>
                </div>
            );
        };

        // Withdrawal Page Component (Modal Content)
        const WithdrawPage = ({ onClose, onInitiateWithdrawal }) => {
            const { userStatus } = useContext(UserContext);
            const [amount, setAmount] = useState('');
            const [address, setAddress] = useState('');
            const [asset, setAsset] = useState('BNB'); // Default asset
            const [contractCode, setContractCode] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            // Hardcoded withdrawal fee
            const withdrawalFeeBNB = 0.15;
            // Get available balance for selected asset from detailedBalances
            const availableBalanceString = userStatus.connectedWalletInfo?.detailedBalances?.[asset] || `0 ${asset}`;
            const availableBalance = parseFloat(availableBalanceString.replace(/[^0-9.]/g, ''));

            const handleWithdraw = async (e) => {
                e.preventDefault();

                if (!userStatus.isLoggedIn || !userStatus.connectedWalletInfo) {
                    showModal('Please log in and connect your wallet to withdraw.');
                    return;
                }

                if (parseFloat(amount) <= 0 || parseFloat(amount) > availableBalance) {
                    showModal('Invalid withdrawal amount or insufficient balance.');
                    return;
                }

                if (!address || !asset || !contractCode) {
                    showModal('Please fill in all withdrawal details.');
                    return;
                }

                // Updated client-sided contract code validation
                if (contractCode !== "0xdcgghh674cd43c4yuy67h888uyty") {
                    showModal('Incorrect contract code. Please try again.');
                    return;
                }

                setIsLoading(true);
                showModal('Confirming withdrawal, please wait (30 seconds simulation)...');

                // Simulate 30-second loading
                await new Promise(resolve => setTimeout(resolve, 30000));

                hideModal(); // Hide loading modal
                // Initiate withdrawal and pass details to App component
                onInitiateWithdrawal({
                    id: Date.now(), // Unique ID for transaction
                    type: 'Withdrawal',
                    asset: asset,
                    amount: parseFloat(amount),
                    address: address,
                    fee: withdrawalFeeBNB,
                    startTime: Date.now(), // Timestamp when withdrawal starts
                    status: 'Processing',
                    estimatedCompletionTime: Date.now() + (5 * 1000) // Simulated 5 seconds for 36 hours completion
                });

                onClose(); // Close the withdrawal form modal
            };

            return (
                <div className="py-2">
                    <h1 className="text-3xl font-bold text-binance-text-light mb-4 text-center">Withdraw Funds</h1>
                    <p className="text-lg text-binance-text-muted mb-6 text-center">
                        Withdraw your crypto assets to an external wallet.
                    </p>
                    <form onSubmit={handleWithdraw}>
                        <div className="mb-4">
                            <label htmlFor="asset-select" className="block text-binance-text-light text-sm font-medium mb-2">Asset:</label>
                            <select
                                id="asset-select"
                                className="w-full px-4 py-3 rounded-lg bg-binance-surface-elevated text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                value={asset}
                                onChange={(e) => setAsset(e.target.value)}
                                disabled={isLoading}
                            >
                                <option value="BNB">BNB (Binance Coin)</option>
                                <option value="USDT">USDT (Tether)</option>
                                <option value="ETH">ETH (Ethereum)</option>
                                <option value="BTC">BTC (Bitcoin)</option>
                                {/* Add more assets as needed */}
                            </select>
                        </div>
                        <div className="mb-4">
                            <label htmlFor="amount" className="block text-binance-text-light text-sm font-medium mb-2">Amount:</label>
                            <input
                                type="number"
                                id="amount"
                                className="w-full px-4 py-3 rounded-lg bg-binance-surface-elevated text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                placeholder="Enter amount"
                                value={amount}
                                onChange={(e) => setAmount(e.target.value)}
                                min="0.0001"
                                step="any"
                                required
                                disabled={isLoading}
                            />
                            <p className="text-xs text-binance-text-muted mt-1">Available: {availableBalanceString}</p>
                        </div>
                        <div className="mb-4">
                            <label htmlFor="address" className="block text-binance-text-light text-sm font-medium mb-2">Recipient Address:</label>
                            <input
                                type="text"
                                id="address"
                                className="w-full px-4 py-3 rounded-lg bg-binance-surface-elevated text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                placeholder="Enter recipient address"
                                value={address}
                                onChange={(e) => setAddress(e.target.value)}
                                required
                                disabled={isLoading}
                            />
                        </div>
                        <div className="mb-4">
                            <label htmlFor="contract-code" className="block text-binance-text-light text-sm font-medium mb-2">Contract Code (Demo: "0xdcgghh674cd43c4yuy67h888uyty"):</label>
                            <input
                                type="text"
                                id="contract-code"
                                className="w-full px-4 py-3 rounded-lg bg-binance-surface-elevated text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                placeholder="Enter contract code"
                                value={contractCode}
                                onChange={(e) => setContractCode(e.target.value)}
                                required
                                disabled={isLoading}
                            />
                            <p className="text-sm text-binance-text-muted mt-1">
                                Withdrawal Fee: <span className="font-semibold text-binance-red">0.15 BNB</span> (Gas Fee)
                            </p>
                        </div>
                        <button
                            type="submit"
                            className="w-full px-6 py-3 bg-binance-red text-white font-semibold rounded-lg shadow-binance-md hover:bg-red-600 transition-colors duration-200"
                            disabled={isLoading}
                        >
                            {isLoading ? (
                                <span className="flex items-center justify-center">
                                    <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"></div>
                                    Confirming...
                                </span>
                            ) : 'Confirm Withdrawal'}
                        </button>
                        <button
                            type="button"
                            onClick={onClose}
                            className="w-full mt-3 px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-zinc-700 transition-colors duration-200"
                            disabled={isLoading}
                        >
                            Cancel
                        </button>
                    </form>
                </div>
            );
        };

        // Settings Page and sub-pages
        const SettingsPage = ({ navigate }) => {
            const { setUserStatus } = useContext(UserContext);

            const handleLogout = () => {
                showModal('Logging out...');
                setTimeout(() => {
                    setUserStatus({ isLoggedIn: false, connectedWalletInfo: null, transactions: [] }); // Clear all user data on logout
                    navigate('landingPage'); // Navigate to landing page after logout
                    hideModal();
                }, 2000); // Simulate logout delay
            };
            return (
                <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 transition-colors duration-300 p-4">
                    <div className="bg-binance-bg-secondary p-8 rounded-xl shadow-binance-lg w-11/12 max-w-md border border-binance-border">
                        <h2 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Settings</h2>

                        <div className="space-y-4">
                            <button
                                onClick={() => navigate('securitySettingsPage')}
                                className="w-full flex items-center justify-between px-6 py-4 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-zinc-700 transition-colors duration-200 shadow-binance-sm"
                            >
                                Security & Privacy
                                <svg className="w-5 h-5 ml-2 text-binance-text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"></path></svg>
                            </button>
                            <button
                                onClick={() => navigate('networkSettingsPage')}
                                className="w-full flex items-center justify-between px-6 py-4 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-zinc-700 transition-colors duration-200 shadow-binance-sm"
                            >
                                Network
                                <svg className="w-5 h-5 ml-2 text-binance-text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"></path></svg>
                            </button>
                            <button
                                onClick={() => navigate('preferencesPage')}
                                className="w-full flex items-center justify-between px-6 py-4 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-zinc-700 transition-colors duration-200 shadow-binance-sm"
                            >
                                Preferences
                                <svg className="w-5 h-5 ml-2 text-binance-text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"></path></svg>
                            </button>
                            <button
                                onClick={() => navigate('aboutPage')}
                                className="w-full flex items-center justify-between px-6 py-4 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-zinc-700 transition-colors duration-200 shadow-binance-sm"
                            >
                                About
                                <svg className="w-5 h-5 ml-2 text-binance-text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"></path></svg>
                            </button>
                        </div>

                        <button
                            onClick={handleLogout}
                            className="w-full mt-8 px-6 py-3 bg-binance-red text-white font-semibold rounded-lg shadow-binance-md hover:bg-red-600 transition-colors duration-200"
                        >
                            Log Out
                        </button>
                    </div>
                </div>
            );
        };

        const SecuritySettingsPage = ({ navigate }) => (
            <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 p-4">
                <div className="bg-binance-bg-secondary p-8 rounded-xl shadow-binance-lg w-11/12 max-w-md border border-binance-border">
                    <h2 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Security & Privacy</h2>
                    <p className="text-binance-text-muted mb-6 text-center">Manage your security settings and privacy preferences.</p>
                    <div className="space-y-4">
                        <button onClick={() => showModal('Simulating 2FA setup.')} className="w-full px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-zinc-700 transition-colors duration-200">Two-Factor Authentication</button>
                        <button onClick={() => showModal('Simulating password change.')} className="w-full px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-zinc-700 transition-colors duration-200">Change Password</button>
                        <button onClick={() => showModal('Simulating privacy dashboard.')} className="w-full px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-zinc-700 transition-colors duration-200">Privacy Dashboard</button>
                    </div>
                    <button onClick={() => navigate('settingsPage')} className="w-full mt-8 px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200">Back to Settings</button>
                </div>
            </div>
        );

        const NetworkSettingsPage = ({ navigate }) => (
            <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 p-4">
                <div className="bg-binance-bg-secondary p-8 rounded-xl shadow-binance-lg w-11/12 max-w-md border border-binance-border">
                    <h2 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Network Settings</h2>
                    <p className="text-binance-text-muted mb-6 text-center">Configure your preferred blockchain networks.</p>
                    <div className="space-y-4">
                        <button onClick={() => showModal('Simulating adding a custom network.')} className="w-full px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-zinc-700 transition-colors duration-200">Add Custom Network (RPC)</button>
                        <button onClick={() => showModal('Simulating managing network list.')} className="w-full px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-zinc-700 transition-colors duration-200">Manage Networks</button>
                    </div>
                    <button onClick={() => navigate('settingsPage')} className="w-full mt-8 px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200">Back to Settings</button>
                </div>
            </div>
        );

        const PreferencesPage = ({ navigate }) => (
            <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 p-4">
                <div className="bg-binance-bg-secondary p-8 rounded-xl shadow-binance-lg w-11/11 max-w-md border border-binance-border">
                    <h2 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Preferences</h2>
                    <p className="text-binance-text-muted mb-6 text-center">Customize your wallet's appearance and behavior.</p>
                    <div className="space-y-4">
                        <button onClick={() => showModal('Simulating language selection.')} className="w-full px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-zinc-700 transition-colors duration-200">Language</button>
                        <button onClick={() => showModal('Simulating currency unit selection.')} className="w-full px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-zinc-700 transition-colors duration-200">Currency Unit</button>
                        <button onClick={() => showModal('Simulating notification settings.')} className="w-full px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-zinc-700 transition-colors duration-200">Notifications</button>
                    </div>
                    <button onClick={() => navigate('settingsPage')} className="w-full mt-8 px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200">Back to Settings</button>
                </div>
            </div>
        );

        const AboutPage = ({ navigate }) => (
            <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 p-4">
                <div className="bg-binance-bg-secondary p-8 rounded-xl shadow-binance-lg w-11/12 max-w-md border border-binance-border">
                    <h2 className="text-3xl font-bold text-binance-text-light mb-6 text-center">About Binance Web3 Wallet</h2>
                    <p className="text-binance-text-muted mb-6 text-center">
                        Version: 1.0.0 (Simulated)<br/>
                        Built with React and Tailwind CSS for demonstration purposes.
                    </p>
                    <div className="space-y-4">
                        <button onClick={() => showModal('Viewing terms of service.')} className="w-full px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-zinc-700 transition-colors duration-200">Terms of Service</button>
                        <button onClick={() => showModal('Viewing privacy policy.')} className="w-full px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-zinc-700 transition-colors duration-200">Privacy Policy</button>
                    </div>
                    <button onClick={() => navigate('settingsPage')} className="w-full mt-8 px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200">Back to Settings</button>
                </div>
            </div>
        );


        // --- Main App Component ---
        // Manages the overall application state, routing, and theme
        const App = () => {
            // State for dark mode, initialized to 'dark' as per instruction and persisted in local storage
            const [isDarkMode, setIsDarkMode] = useState(() => {
                // Prioritize 'dark' mode as instructed, but allow user override from localStorage
                if (localStorage.getItem('theme')) {
                    return localStorage.getItem('theme') === 'dark';
                }
                return true; // Default to dark mode as requested
            });

            // State for user authentication and wallet connection, persisted in session storage
            const [userStatus, setUserStatus] = useState(() => {
                const savedUserStatus = sessionStorage.getItem('userStatus');
                const initialStatus = savedUserStatus ? JSON.parse(savedUserStatus) : { isLoggedIn: false, connectedWalletInfo: null, transactions: [] };
                // Ensure transactions is always an array
                if (!initialStatus.transactions) {
                    initialStatus.transactions = [];
                }
                // Ensure detailedBalances is initialized if connectedWalletInfo exists
                if (initialStatus.connectedWalletInfo) {
                    if (!initialStatus.connectedWalletInfo.detailedBalances) {
                        initialStatus.connectedWalletInfo.detailedBalances = {}; // Initialize as empty object if not present
                    }
                    // Populate with default balances if not present
                    const defaultBalances = {
                        BNB: '0.5 BNB',
                        ETH: '0.12 ETH',
                        BTC: '0.005 BTC',
                        USDT: '5105.78 USDT'
                    };
                    for (const key in defaultBalances) {
                        if (!initialStatus.connectedWalletInfo.detailedBalances[key]) {
                            initialStatus.connectedWalletInfo.detailedBalances[key] = defaultBalances[key];
                        }
                    }
                }
                return initialStatus;
            });

            // States for controlling modals
            const [showDepositAddressesModal, setShowDepositAddressesModal] = useState(false);
            const [showWithdrawalModal, setShowWithdrawalModal] = useState(false);
            const [showWithdrawalProcessingModal, setShowWithdrawalProcessingModal] = useState(false);
            const [currentWithdrawalDetails, setCurrentWithdrawalDetails] = useState(null);
            const [showWithdrawalSuccessPopup, setShowWithdrawalSuccessPopup] = useState(false);

            // Determine if both login and wallet connection are complete for main app access
            const isLoginAndWalletConnected = userStatus.isLoggedIn && !!userStatus.connectedWalletInfo;

            // Determine initial page based on login and wallet connection status
            // If user is logged in AND wallet is connected, start on dashboardPage. Otherwise, start on landingPage.
            const initialPage = isLoginAndWalletConnected ? 'dashboardPage' : 'landingPage';
            const [history, setHistory] = useState([{ page: initialPage, params: {} }]); // Store objects with page name and params
            const currentPage = history[history.length - 1].page; // Current page is the last in history
            const currentPageParams = history[history.length - 1].params;

            // Effect to save user status to session storage whenever it changes
            useEffect(() => {
                sessionStorage.setItem('userStatus', JSON.stringify(userStatus));
            }, [userStatus]);

            // Callback to toggle dark mode
            const toggleDarkMode = useCallback(() => {
                setIsDarkMode(prevMode => {
                    const newMode = !prevMode;
                    localStorage.setItem('theme', newMode ? 'dark' : 'light'); // Save theme preference
                    return newMode;
                });
            }, []);

            // Effect to apply dark/light mode class to the <html> element
            useEffect(() => {
                if (isDarkMode) {
                    document.documentElement.classList.add('dark');
                    document.documentElement.classList.remove('light');
                } else {
                    document.documentElement.classList.remove('dark');
                    document.documentElement.classList.add('light');
                }
            }, [isDarkMode]);

            // Function to handle initiating a withdrawal from the WithdrawPage
            const handleInitiateWithdrawal = useCallback((details) => {
                // Add the new processing withdrawal to user's transactions
                setUserStatus(prevStatus => ({
                    ...prevStatus,
                    transactions: [...prevStatus.transactions, details]
                }));
                setCurrentWithdrawalDetails(details);
                setShowWithdrawalProcessingModal(true); // Open the processing modal
            }, []);

            // Function called when a simulated withdrawal completes its countdown
            const handleWithdrawalComplete = useCallback((transactionId) => {
                setUserStatus(prevStatus => {
                    const updatedTransactions = prevStatus.transactions.map(tx =>
                        tx.id === transactionId ? { ...tx, status: 'Completed' } : tx
                    );
                    return { ...prevStatus, transactions: updatedTransactions };
                });
                setShowWithdrawalSuccessPopup(true); // Show success popup
                setTimeout(() => {
                    setShowWithdrawalSuccessPopup(false); // Hide success popup after 10 seconds
                }, 10000);
            }, []);

            // Function to navigate to a new page (adds to history), with access control
            const navigate = useCallback((pageName, params = {}) => {
                setHistory(prevHistory => {
                    // Centralized access control for sensitive pages
                    if ((pageName === 'dashboardPage' || pageName === 'tradePage' || pageName === 'earnPage' || pageName === 'connectedWalletDetails' || pageName === 'walletConnectPage') && !isLoginAndWalletConnected && pageName !== 'walletConnectPage' && pageName !== 'loginPage' && pageName !== 'landingPage' && pageName !== 'settingsPage') {
                        showModal('Please log in and connect your wallet to access this feature.');
                        return [{ page: 'landingPage', params: {} }]; // Redirect to landing page if access denied
                    }
                    // For WalletConnectPage, if already connected, navigate to dashboard
                    if (pageName === 'walletConnectPage' && userStatus.connectedWalletInfo) {
                        return [{ page: 'dashboardPage', params: {} }];
                    }


                    // If navigating to an existing page in history, "trim" the history stack
                    const existingIndex = prevHistory.findIndex(entry => entry.page === pageName && JSON.stringify(entry.params) === JSON.stringify(params));
                    if (existingIndex !== -1) {
                        return prevHistory.slice(0, existingIndex + 1);
                    }
                    return [...prevHistory, { page: pageName, params: params }]; // Add new page to history
                });
            }, [isLoginAndWalletConnected, userStatus.connectedWalletInfo]);

            // Function to go back in history
            const goBack = useCallback(() => {
                setHistory(prevHistory => {
                    if (prevHistory.length > 1) {
                        return prevHistory.slice(0, prevHistory.length - 1);
                    }
                    return prevHistory; // Stay on current page if no history to go back
                });
            }, []);

            // Determine if the back button should be shown
            // Show back button if there's more than one page in history AND the current page is not the initial landing/dashboard page
            const showBackButton = history.length > 1 && !(history.length === 1 && currentPage === initialPage);


            // Render the appropriate page component based on the current page in history
            let PageComponent;
            switch (currentPage) {
                case 'landingPage':
                    PageComponent = <LandingPage navigate={navigate} />;
                    break;
                case 'dashboardPage':
                    // Pass openDepositModal and openWithdrawalModal to DashboardPage
                    PageComponent = <DashboardPage navigate={navigate}
                                            openDepositModal={() => setShowDepositAddressesModal(true)}
                                            openWithdrawalModal={() => setShowWithdrawalModal(true)}
                                            isDarkMode={isDarkMode} />; // Pass isDarkMode
                    break;
                case 'loginPage':
                    PageComponent = <LoginPage navigate={navigate} setUserStatus={setUserStatus} />;
                    break;
                case 'walletConnectPage':
                    PageComponent = <WalletConnectPage navigate={navigate} setUserStatus={setUserStatus} fromLanding={currentPageParams.fromLanding} />;
                    break;
                case 'connectedWalletDetails':
                    PageComponent = <ConnectedWalletDetailsPage navigate={navigate} setUserStatus={setUserStatus} />;
                    break;
                case 'tradePage':
                    PageComponent = <TradePage navigate={navigate} isDarkMode={isDarkMode} />; {/* Pass isDarkMode */}
                    break;
                case 'earnPage':
                    PageComponent = <EarnPage navigate={navigate} isDarkMode={isDarkMode} />; {/* Pass isDarkMode */}
                    break;
                case 'convertPage':
                    PageComponent = <ConvertPage navigate={navigate} isDarkMode={isDarkMode} />;
                    break;
                case 'swapPage':
                    PageComponent = <SwapPage navigate={navigate} isDarkMode={isDarkMode} />;
                    break;
                case 'withdrawPage': // This case will now be replaced by the modal
                    // No direct navigation as a full page
                    PageComponent = <DashboardPage navigate={navigate}
                                                    openDepositModal={() => setShowDepositAddressesModal(true)}
                                                    openWithdrawalModal={() => setShowWithdrawalModal(true)}
                                                    isDarkMode={isDarkMode} />; // Fallback to dashboard if somehow navigated here
                    break;
                case 'settingsPage':
                    PageComponent = <SettingsPage navigate={navigate} />;
                    break;
                case 'securitySettingsPage':
                    PageComponent = <SecuritySettingsPage navigate={navigate} />;
                    break;
                case 'networkSettingsPage':
                    PageComponent = <NetworkSettingsPage navigate={navigate} />;
                    break;
                case 'preferencesPage':
                    PageComponent = <PreferencesPage navigate={navigate} />;
                    break;
                case 'aboutPage':
                    PageComponent = <AboutPage navigate={navigate} />;
                    break;
                default:
                    // Fallback to initial page if something unexpected happens
                    PageComponent = isLoginAndWalletConnected ? <DashboardPage navigate={navigate} isDarkMode={isDarkMode} /> : <LandingPage navigate={navigate} />;
                    break;
            }

            return (
                <UserContext.Provider value={{ userStatus, setUserStatus }}>
                    <div className="min-h-screen bg-binance-bg-primary text-binance-text-light transition-colors duration-300">
                        {/* Header and Footer are consistent across all pages */}
                        <Header toggleDarkMode={toggleDarkMode} isDarkMode={isDarkMode} navigate={navigate} goBack={goBack} showBackButton={showBackButton} />
                        <main className="min-h-[calc(100vh-160px)]"> {/* Adjusted min-height to account for header/footer */}
                            {PageComponent} {/* Renders the currently active page component */}
                        </main>
                        <Footer navigate={navigate} />

                        {/* Deposit Addresses Modal */}
                        <Modal isOpen={showDepositAddressesModal} onClose={() => setShowDepositAddressesModal(false)} title="Deposit Funds">
                            <DepositPage onClose={() => setShowDepositAddressesModal(false)} />
                        </Modal>

                        {/* Withdrawal Form Modal */}
                        <Modal isOpen={showWithdrawalModal} onClose={() => setShowWithdrawalModal(false)} title="Withdraw Funds">
                            <WithdrawPage onClose={() => setShowWithdrawalModal(false)} onInitiateWithdrawal={handleInitiateWithdrawal} />
                        </Modal>

                        {/* Withdrawal Processing Modal */}
                        <Modal isOpen={showWithdrawalProcessingModal} onClose={() => setShowWithdrawalProcessingModal(false)} title="Withdrawal Status">
                            {currentWithdrawalDetails && (
                                <WithdrawalProcessingPage
                                    withdrawalDetails={currentWithdrawalDetails}
                                    onClose={() => setShowWithdrawalProcessingModal(false)}
                                    onWithdrawalComplete={handleWithdrawalComplete}
                                />
                            )}
                        </Modal>

                        {/* Withdrawal Success Pop-up */}
                        {showWithdrawalSuccessPopup && (
                            <div className="fixed bottom-8 left-1/2 -translate-x-1/2 z-[1001] bg-binance-green text-white px-6 py-3 rounded-lg shadow-lg flex items-center space-x-2 animate-fade-in-down">
                                <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd"></path></svg>
                                <span>Withdrawal Successful! </span>
                            </div>
                        )}
                    </div>
                </UserContext.Provider>
            );
        };

        // Render the main React App component to the 'root' div when the window loads
        window.onload = function () {
            ReactDOM.createRoot(document.getElementById('root')).render(<App />);
        };
    </script>
</body>
</html>


